î¨
;D:\Programavimas\politik\back\Controllers\AuthController.cs
	namespace 	
Politics
 
. 
Controllers 
{ 
[ 
Route 
( 	
$str	 $
)$ %
]% &
[ 
ApiController 
] 
public 
class	 
AuthController 
: 
ControllerBase  .
{ 
private 
readonly 
IAuthService !
_authService" .
;. /
private 
readonly 
IConfiguration #
_config$ +
;+ ,
private 
readonly 
IEmailSender !
_sender" )
;) *
private 
readonly 
IMapper 
_mapper $
;$ %
public 

AuthController 
( 
IAuthService &
authService' 2
,2 3
IConfiguration4 B
configC I
,I J
IEmailSenderK W
senderX ^
,^ _
IMapper` g
mapperh n
)n o
{ 
_authService 
= 
authService  
;  !
_config 
= 
config 
; 
_sender   
=   
sender   
;   
_mapper!! 
=!! 
mapper!! 
;!! 
}"" 
[$$ 
HttpPost$$ 
]$$ 
public%% 

async%% 
Task%% 
<%% 
IActionResult%% #
>%%# $
Register%%% -
(%%- .
[%%. /
FromBody%%/ 7
]%%7 8
RegisterDto%%9 D
registerDto%%E P
)%%P Q
{&& 
if'' 
(''	 

!''
 

ModelState'' 
.'' 
IsValid'' 
)'' 
{(( 
return)) 

BadRequest)) 
()) 

ModelState)) $
)))$ %
;))% &
}** 
var++ 	
existingUser++
 
=++ 
await++ 
_authService++ +
.+++ ,
GetUserByEmail++, :
(++: ;
registerDto++; F
.++F G
Email++G L
)++L M
;++M N
if,, 
(,,	 

existingUser,,
 
is,, 
not,, 
null,, "
),," #
{-- 
return.. 
ValidationProblem..  
(..  !
$str..! W
)..W X
;..X Y
}// 
var00 	
userToCreate00
 
=00 
_mapper00  
.00  !
Map00! $
<00$ %
RegisterDto00% 0
,000 1
User002 6
>006 7
(007 8
registerDto008 C
)00C D
;00D E
userToCreate11 
.11 
	Activated11 
=11 
false11 $
;11$ %
var33 	
createdUser33
 
=33 
await33 
_authService33 *
.33* +
Register33+ 3
(333 4
userToCreate334 @
,33@ A
registerDto33B M
.33M N
Password33N V
)33V W
;33W X
var55 	
token55
 
=55 
await55 
_authService55 $
.55$ %#
GenerateActivationToken55% <
(55< =
createdUser55= H
.55H I
UserId55I O
)55O P
;55P Q
await77 
_sender77 
.77 
SendActivationEmail77 '
(77' (
createdUser77( 3
,773 4
token775 :
)77: ;
;77; <
return99 

StatusCode99 
(99 
$num99 
)99 
;99 
}:: 
[<< 
HttpPost<< 
]<< 
public== 

async== 
Task== 
<== 
IActionResult== #
>==# $
Login==% *
(==* +
[==+ ,
FromBody==, 4
]==4 5
LoginDto==6 >
loginDto==? G
)==G H
{>> 
var?? 	
userFromRepo??
 
=?? 
await?? 
_authService?? +
.??+ ,
Login??, 1
(??1 2
loginDto??2 :
.??: ;
Email??; @
,??@ A
loginDto??B J
.??J K
Password??K S
)??S T
;??T U
ifAA 
(AA	 

userFromRepoAA
 
isAA 
nullAA 
)AA 
{BB 
returnCC 
UnauthorizedCC 
(CC 
)CC 
;CC 
}DD 
ifFF 
(FF	 

!FF
 
userFromRepoFF 
.FF 
	ActivatedFF !
)FF! "
{GG 
returnHH 

BadRequestHH 
(HH 
$strHH R
)HHR S
;HHS T
}II 
varLL 	
tokenHandlerLL
 
=LL 
newLL #
JwtSecurityTokenHandlerLL 4
(LL4 5
)LL5 6
;LL6 7
varMM 	
keyMM
 
=MM 
EncodingMM 
.MM 
ASCIIMM 
.MM 
GetBytesMM '
(MM' (
_configMM( /
.MM/ 0
GetValueMM0 8
<MM8 9
stringMM9 ?
>MM? @
(MM@ A
$strMMA L
)MML M
)MMM N
;MMN O
varNN 	
tokenDescriptorNN
 
=NN 
newNN #
SecurityTokenDescriptorNN  7
{OO 
SubjectPP 
=PP 
newPP 
ClaimsIdentityPP $
(PP$ %
newPP% (
ClaimPP) .
[PP. /
]PP/ 0
{PP0 1
newQQ
 
ClaimQQ 
(QQ 

ClaimTypesQQ 
.QQ 
NameIdentifierQQ -
,QQ- .
userFromRepoQQ/ ;
.QQ; <
UserIdQQ< B
)QQB C
,QQC D
newRR
 
ClaimRR 
(RR 

ClaimTypesRR 
.RR 
EmailRR $
,RR$ %
userFromRepoRR& 2
.RR2 3
EmailRR3 8
)RR8 9
,RR9 :
newSS
 
ClaimSS 
(SS 

ClaimTypesSS 
.SS 
RoleSS #
,SS# $
userFromRepoSS% 1
.SS1 2
RoleSS2 6
.SS6 7
NameSS7 ;
)SS; <
}TT 	
)TT	 

,TT
 
ExpiresUU 
=UU 
DateTimeUU 
.UU 
NowUU 
.UU 
AddDaysUU &
(UU& '
$numUU' (
)UU( )
,UU) *
SigningCredentialsVV 
=VV 
newVV  
SigningCredentialsVV! 3
(VV3 4
newVV4 7 
SymmetricSecurityKeyVV8 L
(VVL M
keyVVM P
)VVP Q
,VVQ R
SecurityAlgorithmsVVS e
.VVe f
HmacSha512SignatureVVf y
)VVy z
}WW 
;WW 
varYY 	
tokenYY
 
=YY 
tokenHandlerYY 
.YY 
CreateTokenYY *
(YY* +
tokenDescriptorYY+ :
)YY: ;
;YY; <
varZZ 	
tokenStringZZ
 
=ZZ 
tokenHandlerZZ $
.ZZ$ %

WriteTokenZZ% /
(ZZ/ 0
tokenZZ0 5
)ZZ5 6
;ZZ6 7
return]] 
Ok]] 
(]] 
new]] 
{]] 
JWT]] 
=]] 
tokenString]] '
}]]( )
)]]) *
;]]* +
}^^ 
[`` 
HttpGet`` 
(`` 
$str`` 
)`` 
]`` 
publicaa 

asyncaa 
Taskaa 
<aa 
IActionResultaa #
>aa# $
Activateaa% -
(aa- .
stringaa. 4
tokenIdaa5 <
)aa< =
{bb 
varcc 	
usercc
 
=cc 
awaitcc 
_authServicecc #
.cc# $
ActivateUsercc$ 0
(cc0 1
tokenIdcc1 8
)cc8 9
;cc9 :
ifdd 
(dd	 

userdd
 
.dd 
	Activateddd 
)dd 
{ee 
returnff 
Redirectff 
(ff 
$strff 9
)ff9 :
;ff: ;
}gg 
returnhh 

BadRequesthh 
(hh 
$strhh 0
)hh0 1
;hh1 2
}ii 
[kk 
HttpPostkk 
]kk 
publicll 

asyncll 
Taskll 
<ll 
IActionResultll #
>ll# $

EmailTakenll% /
(ll/ 0
stringll0 6
emailll7 <
)ll< =
{mm 
ifnn 
(nn	 

awaitnn
 
_authServicenn 
.nn 

UserExistsnn '
(nn' (
emailnn( -
)nn- .
)nn. /
{oo 
returnpp 

BadRequestpp 
(pp 
$strpp 2
)pp2 3
;pp3 4
}qq 
returnrr 
Okrr 
(rr 
)rr 
;rr 
}ss 
[tt 
	Authorizett 
]tt 
[uu 
HttpGetuu 
]uu 
publicvv 

asyncvv 
Taskvv 
<vv 
ActionResultvv "
<vv" #
UserProfileDtovv# 1
>vv1 2
>vv2 3
CurrentUservv4 ?
(vv? @
)vv@ A
{ww 
varxx 	
userIdxx
 
=xx 
HttpContextxx 
.xx 
Userxx #
.xx# $
FindFirstValuexx$ 2
(xx2 3

ClaimTypesxx3 =
.xx= >
NameIdentifierxx> L
)xxL M
;xxM N
varyy 	
profileyy
 
=yy 
awaityy 
_authServiceyy &
.yy& '
GetUserByIdyy' 2
(yy2 3
userIdyy3 9
)yy9 :
;yy: ;
ifzz 
(zz	 

profilezz
 
iszz 
nullzz 
)zz 
{{{ 
return|| 

BadRequest|| 
(|| 
)|| 
;|| 
}}} 
return~~ 
Ok~~ 
(~~ 
profile~~ 
)~~ 
;~~ 
} 
[
ÄÄ 
	Authorize
ÄÄ 
]
ÄÄ 
[
ÅÅ 
HttpPost
ÅÅ 
]
ÅÅ 
public
ÇÇ 

async
ÇÇ 
Task
ÇÇ 
<
ÇÇ 
ActionResult
ÇÇ "
>
ÇÇ" #
ChangeEmail
ÇÇ$ /
(
ÇÇ/ 0
[
ÇÇ0 1
FromBody
ÇÇ1 9
]
ÇÇ9 :
ChangeEmailDto
ÇÇ; I
changeEmail
ÇÇJ U
)
ÇÇU V
{
ÉÉ 
var
ÑÑ 	
userIdFromAuth
ÑÑ
 
=
ÑÑ 
HttpContext
ÑÑ &
.
ÑÑ& '
User
ÑÑ' +
.
ÑÑ+ ,
FindFirstValue
ÑÑ, :
(
ÑÑ: ;

ClaimTypes
ÑÑ; E
.
ÑÑE F
NameIdentifier
ÑÑF T
)
ÑÑT U
;
ÑÑU V
if
ÖÖ 
(
ÖÖ	 

userIdFromAuth
ÖÖ
 
!=
ÖÖ 
changeEmail
ÖÖ '
.
ÖÖ' (
UserId
ÖÖ( .
)
ÖÖ. /
{
ÜÜ 
return
áá 
Unauthorized
áá 
(
áá 
)
áá 
;
áá 
}
àà 
var
ââ 	
token
ââ
 
=
ââ 
await
ââ 
_authService
ââ $
.
ââ$ %&
GenerateEmailChangeToken
ââ% =
(
ââ= >
changeEmail
ââ> I
.
ââI J
UserId
ââJ P
,
ââP Q
changeEmail
ââR ]
.
ââ] ^
NewEmail
ââ^ f
)
ââf g
;
ââg h
var
ää 	
user
ää
 
=
ää 
await
ää 
_authService
ää #
.
ää# $
GetUserById
ää$ /
(
ää/ 0
changeEmail
ää0 ;
.
ää; <
UserId
ää< B
)
ääB C
;
ääC D
await
åå 
_sender
åå 
.
åå #
SendEmailConfirmation
åå )
(
åå) *
user
åå* .
,
åå. /
changeEmail
åå0 ;
.
åå; <
NewEmail
åå< D
,
ååD E
token
ååF K
)
ååK L
;
ååL M
return
éé 
Ok
éé 
(
éé 
$str
éé 0
)
éé0 1
;
éé1 2
}
èè 
[
êê 
HttpPost
êê 
(
êê 
$str
êê 
)
êê 
]
êê 
public
ëë 

async
ëë 
Task
ëë 
<
ëë 
ActionResult
ëë "
>
ëë" # 
ConfirmEmailChange
ëë$ 6
(
ëë6 7
string
ëë7 =
tokenId
ëë> E
)
ëëE F
{
íí 
var
ìì 	
user
ìì
 
=
ìì 
await
ìì 
_authService
ìì #
.
ìì# $
UpdateEmail
ìì$ /
(
ìì/ 0
tokenId
ìì0 7
)
ìì7 8
;
ìì8 9
if
îî 
(
îî	 

user
îî
 
is
îî 
null
îî 
)
îî 
{
ïï 
return
ññ 

BadRequest
ññ 
(
ññ 
)
ññ 
;
ññ 
}
óó 
return
òò 
Redirect
òò 
(
òò 
$str
òò 7
)
òò7 8
;
òò8 9
}
ôô 
[
öö 
	Authorize
öö 
]
öö 
[
õõ 
HttpPost
õõ 
]
õõ 
public
úú 

async
úú 
Task
úú 
<
úú 
ActionResult
úú "
<
úú" #
UserProfileDto
úú# 1
>
úú1 2
>
úú2 3
ChangePassword
úú4 B
(
úúB C
[
úúC D
FromBody
úúD L
]
úúL M
ChangePasswordDto
úúN _
changePassword
úú` n
)
úún o
{
ùù 
var
ûû 	
userIdFromAuth
ûû
 
=
ûû 
HttpContext
ûû &
.
ûû& '
User
ûû' +
.
ûû+ ,
FindFirstValue
ûû, :
(
ûû: ;

ClaimTypes
ûû; E
.
ûûE F
NameIdentifier
ûûF T
)
ûûT U
;
ûûU V
if
üü 
(
üü	 

userIdFromAuth
üü
 
!=
üü 
changePassword
üü *
.
üü* +
UserId
üü+ 1
)
üü1 2
{
†† 
return
°° 
Unauthorized
°° 
(
°° 
)
°° 
;
°° 
}
¢¢ 
if
££ 
(
££	 

changePassword
££
 
.
££ 
NewPassword
££ $
.
££$ %
Length
££% +
<
££, -
$num
££. /
)
££/ 0
{
§§ 
return
•• 
ValidationProblem
••  
(
••  !
$str
••! A
)
••A B
;
••B C
}
¶¶ 
if
ßß 
(
ßß	 

changePassword
ßß
 
.
ßß 
NewPassword
ßß $
.
ßß$ %
Length
ßß% +
>
ßß, -
$num
ßß. 0
)
ßß0 1
{
®® 
return
©© 
ValidationProblem
©©  
(
©©  !
$str
©©! ?
)
©©? @
;
©©@ A
}
™™ 
var
´´ 	
user
´´
 
=
´´ 
await
´´ 
_authService
´´ #
.
´´# $
GetUserById
´´$ /
(
´´/ 0
changePassword
´´0 >
.
´´> ?
UserId
´´? E
)
´´E F
;
´´F G
var
¨¨ 	
passwordsMatch
¨¨
 
=
¨¨ 
await
¨¨  
_authService
¨¨! -
.
¨¨- .
Login
¨¨. 3
(
¨¨3 4
user
¨¨4 8
.
¨¨8 9
Email
¨¨9 >
,
¨¨> ?
changePassword
¨¨@ N
.
¨¨N O
OldPassword
¨¨O Z
)
¨¨Z [
;
¨¨[ \
if
≠≠ 
(
≠≠	 

passwordsMatch
≠≠
 
is
≠≠ 
null
≠≠  
)
≠≠  !
{
ÆÆ 
return
ØØ 
ValidationProblem
ØØ  
(
ØØ  !
$str
ØØ! ;
)
ØØ; <
;
ØØ< =
}
∞∞ 
var
±± 	
profile
±±
 
=
±± 
await
±± 
_authService
±± &
.
±±& '
ChangePassword
±±' 5
(
±±5 6
changePassword
±±6 D
.
±±D E
UserId
±±E K
,
±±K L
changePassword
±±M [
.
±±[ \
NewPassword
±±\ g
)
±±g h
;
±±h i
return
≤≤ 
Ok
≤≤ 
(
≤≤ 
profile
≤≤ 
)
≤≤ 
;
≤≤ 
}
≥≥ 
[
¥¥ 
	Authorize
¥¥ 
]
¥¥ 
[
µµ 
HttpPost
µµ 
]
µµ 
public
∂∂ 

async
∂∂ 
Task
∂∂ 
<
∂∂ 
ActionResult
∂∂ "
<
∂∂" #
UserProfileDto
∂∂# 1
>
∂∂1 2
>
∂∂2 3
ChangeDisplayName
∂∂4 E
(
∂∂E F
[
∂∂F G
FromBody
∂∂G O
]
∂∂O P"
ChangeDisplayNameDto
∂∂Q e
changeDisplayName
∂∂f w
)
∂∂w x
{
∑∑ 
var
∏∏ 	
userIdFromAuth
∏∏
 
=
∏∏ 
HttpContext
∏∏ &
.
∏∏& '
User
∏∏' +
.
∏∏+ ,
FindFirstValue
∏∏, :
(
∏∏: ;

ClaimTypes
∏∏; E
.
∏∏E F
NameIdentifier
∏∏F T
)
∏∏T U
;
∏∏U V
if
ππ 
(
ππ	 

changeDisplayName
ππ
 
.
ππ 
UserId
ππ "
!=
ππ# %
userIdFromAuth
ππ& 4
)
ππ4 5
{
∫∫ 
return
ªª 
Unauthorized
ªª 
(
ªª 
)
ªª 
;
ªª 
}
ºº 
var
ΩΩ 	
profile
ΩΩ
 
=
ΩΩ 
await
ΩΩ 
_authService
ΩΩ &
.
ΩΩ& '
ChangeDisplayName
ΩΩ' 8
(
ΩΩ8 9
changeDisplayName
ΩΩ9 J
.
ΩΩJ K
UserId
ΩΩK Q
,
ΩΩQ R
changeDisplayName
ΩΩS d
.
ΩΩd e
NewDisplayName
ΩΩe s
)
ΩΩs t
;
ΩΩt u
if
ææ 
(
ææ	 

profile
ææ
 
is
ææ 
null
ææ 
)
ææ 
{
øø 
return
¿¿ 
ValidationProblem
¿¿  
(
¿¿  !
$str
¿¿! B
)
¿¿B C
;
¿¿C D
}
¡¡ 
return
¬¬ 
Ok
¬¬ 
(
¬¬ 
profile
¬¬ 
)
¬¬ 
;
¬¬ 
}
√√ 
[
ƒƒ 
	Authorize
ƒƒ 
]
ƒƒ 
[
≈≈ 
HttpPost
≈≈ 
(
≈≈ 
$str
≈≈ 
)
≈≈ 
]
≈≈ 
public
∆∆ 

async
∆∆ 
Task
∆∆ 
<
∆∆ 
ActionResult
∆∆ "
>
∆∆" #
AddModerator
∆∆$ 0
(
∆∆0 1
string
∆∆1 7
id
∆∆8 :
)
∆∆: ;
{
«« 
var
»» 	
role
»»
 
=
»» 
HttpContext
»» 
.
»» 
User
»» !
.
»»! "
FindFirstValue
»»" 0
(
»»0 1

ClaimTypes
»»1 ;
.
»»; <
Role
»»< @
)
»»@ A
;
»»A B
if
…… 
(
……	 

role
……
 
!=
…… 
$str
…… 
)
…… 
{
   
return
ÀÀ 
Unauthorized
ÀÀ 
(
ÀÀ 
)
ÀÀ 
;
ÀÀ 
}
ÃÃ 
var
ÕÕ 	
result
ÕÕ
 
=
ÕÕ 
await
ÕÕ 
_authService
ÕÕ %
.
ÕÕ% &
MakeModerator
ÕÕ& 3
(
ÕÕ3 4
id
ÕÕ4 6
)
ÕÕ6 7
;
ÕÕ7 8
if
ŒŒ 
(
ŒŒ	 

result
ŒŒ
 
)
ŒŒ 
{
œœ 
return
–– 
Ok
–– 
(
–– 
)
–– 
;
–– 
}
—— 
return
““ 

BadRequest
““ 
(
““ 
$str
““ ,
)
““, -
;
““- .
}
”” 
[
‘‘ 
	Authorize
‘‘ 
]
‘‘ 
[
’’ 
HttpGet
’’ 
]
’’ 
public
÷÷ 

async
÷÷ 
Task
÷÷ 
<
÷÷ 
ActionResult
÷÷ "
<
÷÷" #
PaginatedList
÷÷# 0
<
÷÷0 1
UserProfileDto
÷÷1 ?
>
÷÷? @
>
÷÷@ A
>
÷÷A B
GetUsers
÷÷C K
(
÷÷K L
[
÷÷L M
	FromQuery
÷÷M V
]
÷÷V W
UsersParams
÷÷X c

parameters
÷÷d n
)
÷÷n o
{
◊◊ 
var
ÿÿ 	
role
ÿÿ
 
=
ÿÿ 
HttpContext
ÿÿ 
.
ÿÿ 
User
ÿÿ !
.
ÿÿ! "
FindFirstValue
ÿÿ" 0
(
ÿÿ0 1

ClaimTypes
ÿÿ1 ;
.
ÿÿ; <
Role
ÿÿ< @
)
ÿÿ@ A
;
ÿÿA B
if
ŸŸ 
(
ŸŸ	 

role
ŸŸ
 
!=
ŸŸ 
$str
ŸŸ 
)
ŸŸ 
{
⁄⁄ 
return
€€ 
Unauthorized
€€ 
(
€€ 
)
€€ 
;
€€ 
}
‹‹ 
var
›› 	
users
››
 
=
›› 
await
›› 
_authService
›› $
.
››$ %
GetUsers
››% -
(
››- .

parameters
››. 8
.
››8 9

PageNumber
››9 C
,
››C D

parameters
››E O
.
››O P
PageSize
››P X
,
››X Y

parameters
››Z d
.
››d e
Search
››e k
)
››k l
;
››l m
return
ﬁﬁ 
Ok
ﬁﬁ 
(
ﬁﬁ 
users
ﬁﬁ 
)
ﬁﬁ 
;
ﬁﬁ 
}
ﬂﬂ 
public
‡‡ 

class
‡‡ 
UsersParams
‡‡ 
:
‡‡ 
PaginationParams
‡‡ /
{
·· 
public
‚‚ 
string
‚‚ 
?
‚‚ 
Search
‚‚ 
{
‚‚ 
get
‚‚ !
;
‚‚! "
set
‚‚# &
;
‚‚& '
}
‚‚( )
}
„„ 
}
‰‰ 
}ÂÂ π'
>D:\Programavimas\politik\back\Controllers\PartiesController.cs
	namespace		 	
Politics		
 
.		 
Controllers		 
{

 
[ 
Route 
( 	
$str	 
) 
] 
[ 
ApiController 
] 
public 
class	 
PartiesController  
:! "
ControllerBase# 1
{ 
private 
readonly 
IPartiesRepository '
_repo( -
;- .
public 

PartiesController 
( 
IPartiesRepository /
repo0 4
)4 5
{ 
_repo 
= 
repo 
; 
} 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
List# '
<' (
PartyOutDto( 3
>3 4
>4 5
>5 6
GetAllParties7 D
(D E
)E F
{ 
var 	
parties
 
= 
await 
_repo 
.  
GetAllParties  -
(- .
). /
;/ 0
return 
Ok 
( 
parties 
) 
; 
} 
[ 
HttpGet 
( 
$str 
) 
] 
public 

async 
Task 
< 
ActionResult "
<" #
PartyOutDto# .
>. /
>/ 0
GetPartyById1 =
(= >
string> D
idE G
)G H
{ 
var 	
party
 
= 
await 
_repo 
. 
GetPartyById *
(* +
id+ -
)- .
;. /
if 
(	 

party
 
is 
null 
) 
{ 
return   
ValidationProblem    
(    !
$str  ! C
)  C D
;  D E
}!! 
return"" 
Ok"" 
("" 
party"" 
)"" 
;"" 
}## 
[$$ 
	Authorize$$ 
]$$ 
[%% 
HttpPost%% 
]%% 
public&& 

async&& 
Task&& 
<&& 
ActionResult&& "
<&&" #
PartyOutDto&&# .
>&&. /
>&&/ 0
AddParty&&1 9
(&&9 :
PartyDto&&: B
partyDto&&C K
)&&K L
{'' 
var(( 	
userId((
 
=(( 
HttpContext(( 
.(( 
User(( #
.((# $
FindFirstValue(($ 2
(((2 3

ClaimTypes((3 =
.((= >
NameIdentifier((> L
)((L M
;((M N
var)) 	
party))
 
=)) 
await)) 
_repo)) 
.)) 
AddParty)) &
())& '
partyDto))' /
,))/ 0
userId))1 7
)))7 8
;))8 9
if** 
(**	 

party**
 
is** 
null** 
)** 
{++ 
return,, 
ValidationProblem,,  
(,,  !
$str,,! <
),,< =
;,,= >
}-- 
return.. 
Ok.. 
(.. 
party.. 
).. 
;.. 
}// 
[00 
	Authorize00 
]00 
[11 

HttpDelete11 
(11 
$str11 
)11 
]11 
public22 

async22 
Task22 
<22 
ActionResult22 "
>22" #
DeleteParty22$ /
(22/ 0
string220 6
id227 9
)229 :
{33 
var44 	
role44
 
=44 
HttpContext44 
.44 
User44 !
.44! "
FindFirstValue44" 0
(440 1

ClaimTypes441 ;
.44; <
Role44< @
)44@ A
;44A B
if55 
(55	 

role55
 
!=55 
$str55 
&&55 
role55 "
!=55# %
$str55& +
)55+ ,
{66 
return77 
Unauthorized77 
(77 
)77 
;77 
}88 
var99 	
party99
 
=99 
await99 
_repo99 
.99 
DeleteParty99 )
(99) *
id99* ,
)99, -
;99- .
if:: 
(::	 

party::
 
is:: 
null:: 
):: 
{;; 
return<< 
ValidationProblem<<  
(<<  !
$str<<! 2
)<<2 3
;<<3 4
}== 
return>> 
	NoContent>> 
(>> 
)>> 
;>> 
}?? 
}@@ 
}AA ÉT
BD:\Programavimas\politik\back\Controllers\PoliticiansController.cs
	namespace

 	
Politics


 
.

 
Controllers

 
{ 
[ 
Route 
( 	
$str	 
) 
] 
[ 
ApiController 
] 
public 
class	 !
PoliticiansController $
:% &
ControllerBase' 5
{ 
private 
readonly "
IPoliticiansRepository +
_repo, 1
;1 2
public 
!
PoliticiansController  
(  !"
IPoliticiansRepository! 7
repo8 <
)< =
{ 
_repo 
= 
repo 
; 
} 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
PaginatedList# 0
<0 1
PoliticianOutDto1 A
>A B
>B C
>C D
GetAllPoliticiansE V
(V W
[W X
	FromQueryX a
]a b
PoliticiansParamsc t

parametersu 
)	 Ä
{ 
var 	
politicians
 
= 
await 
_repo #
.# $
GetAllPoliticians$ 5
(5 6

parameters6 @
.@ A

PageNumberA K
,K L

parametersM W
.W X
PageSizeX `
,` a

parametersb l
.l m
PartyIdm t
,t u

parameters	v Ä
.
Ä Å
Search
Å á
)
á à
;
à â
var 	
paginationMetadata
 
= 
new "
{ 
politicians 
. 
Count 
, 
politicians 
. 
PageSize 
, 
politicians 
. 
	PageIndex 
, 
politicians 
. 

TotalPages 
, 
politicians   
.   
HasNextPage   
,    
politicians!! 
.!! 
HasPreviousPage!! #
}"" 
;"" 
Response## 
.## 
Headers## 
.## 
Add## 
(## 
$str## )
,##) *
JsonSerializer##+ 9
.##9 :
	Serialize##: C
(##C D
paginationMetadata##D V
)##V W
)##W X
;##X Y
return%% 
Ok%% 
(%% 
politicians%% 
)%% 
;%% 
}&& 
['' 
HttpGet'' 
('' 
$str'' 
)'' 
]'' 
public(( 

async(( 
Task(( 
<(( 
ActionResult(( "
<((" #
PoliticianOutDto((# 3
>((3 4
>((4 5
GetPoliticianById((6 G
(((G H
string((H N
id((O Q
)((Q R
{)) 
return** 
await** 
_repo** 
.** 
GetPoliticianById** *
(*** +
id**+ -
)**- .
;**. /
}++ 
[,, 
	Authorize,, 
],, 
[-- 
HttpPost-- 
]-- 
public.. 

async.. 
Task.. 
<.. 
ActionResult.. "
>.." #
AddPolitician..$ 1
(..1 2
PoliticianDto..2 ?
politicianDto..@ M
)..M N
{// 
if00 
(00	 

politicianDto00
 
.00 
	FirstName00 !
is00" $
null00% )
||00* ,
politicianDto00- :
.00: ;
	FirstName00; D
.00D E
Length00E K
<00L M
$num00N O
)00O P
{11 
return22 
ValidationProblem22  
(22  !
$str22! <
)22< =
;22= >
}33 
if44 
(44	 

politicianDto44
 
.44 
	FirstName44 !
is44" $
null44% )
||44* ,
politicianDto44- :
.44: ;
	FirstName44; D
.44D E
Length44E K
>44L M
$num44N P
)44P Q
{55 
return66 
ValidationProblem66  
(66  !
$str66! e
)66e f
;66f g
}77 
if88 
(88	 

politicianDto88
 
.88 
LastName88  
is88! #
null88$ (
||88) +
politicianDto88, 9
.889 :
LastName88: B
.88B C
Length88C I
<88J K
$num88L M
)88M N
{99 
return:: 
ValidationProblem::  
(::  !
$str::! ?
)::? @
;::@ A
};; 
if<< 
(<<	 

politicianDto<<
 
.<< 
LastName<<  
is<<! #
null<<$ (
||<<) +
politicianDto<<, 9
.<<9 :
LastName<<: B
.<<B C
Length<<C I
><<J K
$num<<L N
)<<N O
{== 
return>> 
ValidationProblem>>  
(>>  !
$str>>! f
)>>f g
;>>g h
}?? 
if@@ 
(@@	 

politicianDto@@
 
.@@ 
Description@@ #
is@@$ &
null@@' +
||@@, .
politicianDto@@/ <
.@@< =
Description@@= H
.@@H I
Length@@I O
<@@P Q
$num@@R S
)@@S T
{AA 
returnBB 
ValidationProblemBB  
(BB  !
$strBB! @
)BB@ A
;BBA B
}CC 
ifDD 
(DD	 

politicianDtoDD
 
.DD 
DescriptionDD #
isDD$ &
nullDD' +
||DD, .
politicianDtoDD/ <
.DD< =
DescriptionDD= H
.DDH I
LengthDDI O
>DDP Q
$numDDR U
)DDU V
{EE 
returnFF 
ValidationProblemFF  
(FF  !
$strFF! i
)FFi j
;FFj k
}GG 
varII 	
userIdII
 
=II 
HttpContextII 
.II 
UserII #
.II# $
FindFirstValueII$ 2
(II2 3

ClaimTypesII3 =
.II= >
NameIdentifierII> L
)IIL M
;IIM N
varJJ 	
createdPoliticianJJ
 
=JJ 
awaitJJ #
_repoJJ$ )
.JJ) *
AddPoliticianJJ* 7
(JJ7 8
politicianDtoJJ8 E
,JJE F
userIdJJG M
)JJM N
;JJN O
ifKK 
(KK	 

createdPoliticianKK
 
isKK 
nullKK #
)KK# $
{LL 
returnMM 
ValidationProblemMM  
(MM  !
$strMM! <
)MM< =
;MM= >
}NN 
returnOO 
OkOO 
(OO 
createdPoliticianOO !
)OO! "
;OO" #
}PP 
[QQ 
	AuthorizeQQ 
]QQ 
[RR 
HttpPutRR 
(RR 
$strRR 
)RR 
]RR 
publicSS 

asyncSS 
TaskSS 
<SS 
ActionResultSS "
<SS" #
PoliticianOutDtoSS# 3
>SS3 4
>SS4 5
UpdatePoliticianSS6 F
(SSF G
stringSSG M
idSSN P
,SSP Q
[SSR S
FromBodySSS [
]SS[ \
UpdatePoliticianDtoSS] p

politicianSSq {
)SS{ |
{TT 
varUU 	
userIdUU
 
=UU 
HttpContextUU 
.UU 
UserUU #
.UU# $
FindFirstValueUU$ 2
(UU2 3

ClaimTypesUU3 =
.UU= >
NameIdentifierUU> L
)UUL M
;UUM N
ifVV 
(VV	 

awaitVV
 
_repoVV 
.VV 
GetPoliticianByIdVV '
(VV' (
idVV( *
)VV* +
isVV, .
nullVV/ 3
)VV3 4
{WW 
returnXX 
ValidationProblemXX  
(XX  !
$strXX! A
)XXA B
;XXB C
}YY 
varZZ 	
updatedPoliticianZZ
 
=ZZ 
awaitZZ #
_repoZZ$ )
.ZZ) *
UpdatePoliticianZZ* :
(ZZ: ;
idZZ; =
,ZZ= >

politicianZZ? I
,ZZI J
userIdZZK Q
)ZZQ R
;ZZR S
return[[ 
Ok[[ 
([[ 
updatedPolitician[[ !
)[[! "
;[[" #
}\\ 
[]] 
	Authorize]] 
]]] 
[^^ 

HttpDelete^^ 
(^^ 
$str^^ 
)^^ 
]^^ 
public__ 

async__ 
Task__ 
<__ 
IActionResult__ #
>__# $
DeletePolitician__% 5
(__5 6
string__6 <
id__= ?
)__? @
{`` 
varaa 	
roleaa
 
=aa 
HttpContextaa 
.aa 
Useraa !
.aa! "
FindFirstValueaa" 0
(aa0 1

ClaimTypesaa1 ;
.aa; <
Roleaa< @
)aa@ A
;aaA B
ifbb 
(bb	 

rolebb
 
!=bb 
$strbb 
&&bb 
rolebb !
!=bb" $
$strbb% *
)bb* +
{cc 
returndd 
Unauthorizeddd 
(dd 
)dd 
;dd 
}ee 
varff 	

politicianff
 
=ff 
awaitff 
_repoff "
.ff" #
DeletePoliticianff# 3
(ff3 4
idff4 6
)ff6 7
;ff7 8
ifgg 
(gg	 


politiciangg
 
isgg 
nullgg 
)gg 
{hh 
returnii 
ValidationProblemii  
(ii  !
$strii! 5
)ii5 6
;ii6 7
}jj 
returnkk 
	NoContentkk 
(kk 
)kk 
;kk 
}ll 
}mm 
publicoo 
classoo	 
PoliticiansParamsoo  
:oo! "
PaginationParamsoo# 3
{oo4 5
publicpp 

stringpp 
?pp 
PartyIdpp 
{pp 
getpp  
;pp  !
setpp" %
;pp% &
}pp' (
publicqq 

stringqq 
?qq 
Searchqq 
{qq 
getqq 
;qq  
setqq! $
;qq$ %
}qq& '
}rr 
}ss ô(
>D:\Programavimas\politik\back\Controllers\ReportsController.cs
	namespace

 	
Politics


 
.

 
Controllers

 
{ 
[ 
Route 
( 	
$str	 
) 
] 
[ 
ApiController 
] 
public 
class	 
ReportsController  
:! "
ControllerBase# 1
{ 
private 
readonly 
IReportsRepository '
_reportsRepo( 4
;4 5
public 

ReportsController 
( 
IReportsRepository /
reportsRepo0 ;
); <
{ 
_reportsRepo 
= 
reportsRepo  
;  !
} 
[ 
	Authorize 
] 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
PaginatedList# 0
<0 1
ReportOutDto1 =
>= >
>> ?
>? @

GetReportsA K
(K L
ReportsParamsL Y

parametersZ d
)d e
{ 
var 	
role
 
= 
HttpContext 
. 
User !
.! "
FindFirstValue" 0
(0 1

ClaimTypes1 ;
.; <
Role< @
)@ A
;A B
if 
(	 

role
 
!= 
$str 
&& 
role !
!=" $
$str% *
)* +
{ 
return 
Unauthorized 
( 
) 
; 
} 
return 
Ok 
( 
await 
_reportsRepo "
." #

GetReports# -
(- .

parameters. 8
.8 9

PageNumber9 C
,C D

parametersE O
.O P
PageSizeP X
,X Y

parametersZ d
.d e

IsReviewede o
)o p
)p q
;q r
}   
[!! 
	Authorize!! 
]!! 
["" 
HttpPost"" 
]"" 
public## 

async## 
Task## 
<## 
ActionResult## "
<##" #
ReportOutDto### /
>##/ 0
>##0 1
	AddReport##2 ;
(##; <
	ReportDto##< E
report##F L
)##L M
{$$ 
var%% 	
userId%%
 
=%% 
HttpContext%% 
.%% 
User%% #
.%%# $
FindFirstValue%%$ 2
(%%2 3

ClaimTypes%%3 =
.%%= >
NameIdentifier%%> L
)%%L M
;%%M N
return&& 
await&& 
_reportsRepo&& 
.&&  
GenerateReport&&  .
(&&. /
report&&/ 5
,&&5 6
userId&&7 =
)&&= >
;&&> ?
}'' 
[)) 
	Authorize)) 
])) 
[** 
HttpPost** 
(** 
$str** !
)**! "
]**" #
public++ 

async++ 
Task++ 
<++ 
ActionResult++ "
>++" #
ReviewReport++$ 0
(++0 1
string++1 7
reportId++8 @
)++@ A
{,, 
var-- 	
userId--
 
=-- 
HttpContext-- 
.-- 
User-- #
.--# $
FindFirstValue--$ 2
(--2 3

ClaimTypes--3 =
.--= >
NameIdentifier--> L
)--L M
;--M N
var.. 	
role..
 
=.. 
HttpContext.. 
... 
User.. !
...! "
FindFirstValue.." 0
(..0 1

ClaimTypes..1 ;
...; <
Role..< @
)..@ A
;..A B
if// 
(//	 

role//
 
!=// 
$str// 
&&// 
role// !
!=//" $
$str//% *
)//* +
{00 
return11 
Unauthorized11 
(11 
)11 
;11 
}22 
var33 	
result33
 
=33 
await33 
_reportsRepo33 %
.33% &
ReviewReport33& 2
(332 3
reportId333 ;
,33; <
userId33= C
)33C D
;33D E
if44 
(44	 

result44
 
)44 
{55 
return66 
Ok66 
(66 
)66 
;66 
}77 
return88 

BadRequest88 
(88 
$str88 5
)885 6
;886 7
}99 
public;; 

class;; 
ReportsParams;; 
:;;  
PaginationParams;;! 1
{<< 
public== 
bool== 

IsReviewed== 
{== 
get== "
;==" #
set==$ '
;==' (
}==) *
}>> 
}?? 
}@@ éâ
AD:\Programavimas\politik\back\Controllers\StatementsController.cs
	namespace 	
Politics
 
. 
Controllers 
{ 
[ 
Route 
( 	
$str	 
) 
] 
[ 
ApiController 
] 
public 
class	  
StatementsController #
:$ %
ControllerBase& 4
{ 
private 
readonly !
IStatementsRepository *
_statementsRepo+ :
;: ;
private 
readonly "
IPoliticiansRepository +
_politiciansRepo, <
;< =
private 
readonly 
IAuthService !
_authService" .
;. /
public 
 
StatementsController 
(  !
IStatementsRepository  5
statementsRepo6 D
,D E"
IPoliticiansRepositoryF \
politiciansRepo] l
,l m
IAuthServicen z
authService	{ Ü
)
Ü á
{ 
_statementsRepo 
= 
statementsRepo &
;& '
_politiciansRepo 
= 
politiciansRepo (
;( )
_authService 
= 
authService  
;  !
} 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
PaginatedList# 0
<0 1
StatementOutDto1 @
>@ A
>A B
>B C
GetAllStatementsD T
(T U
[U V
	FromQueryV _
]_ `
StatementsParamsa q

parametersr |
)| }
{ 
var   	

statements  
 
=   
await   
_statementsRepo   ,
.  , -
GetAllStatements  - =
(  = >

parameters  > H
.  H I

Politician  I S
,  S T

parameters  U _
.  _ `
Tags  ` d
,  d e

parameters  f p
.  p q

PageNumber  q {
,  { |

parameters	  } á
.
  á à
PageSize
  à ê
)
  ê ë
;
  ë í
var!! 	
paginationMetadata!!
 
=!! 
new!! "
{"" 

statements## 
.## 
Count## 
,## 

statements$$ 
.$$ 
PageSize$$ 
,$$ 

statements%% 
.%% 
	PageIndex%% 
,%% 

statements&& 
.&& 

TotalPages&& 
,&& 

statements'' 
.'' 
HasNextPage'' 
,'' 

statements(( 
.(( 
HasPreviousPage(( "
})) 
;)) 
Response** 
.** 
Headers** 
.** 
Add** 
(** 
$str** )
,**) *
JsonSerializer**+ 9
.**9 :
	Serialize**: C
(**C D
paginationMetadata**D V
)**V W
)**W X
;**X Y
return,, 
Ok,, 
(,, 

statements,, 
),, 
;,, 
}-- 
[.. 
HttpGet.. 
(.. 
$str.. 
).. 
].. 
public// 

async// 
Task// 
<// 
ActionResult// "
<//" #
StatementOutDto//# 2
>//2 3
>//3 4
GetStatetementById//5 G
(//G H
string//H N
id//O Q
)//Q R
{00 
return11 
Ok11 
(11 
await11 
_statementsRepo11 %
.11% &
GetStatementById11& 6
(116 7
id117 9
)119 :
)11: ;
;11; <
}22 
[33 
	Authorize33 
]33 
[44 
HttpPost44 
]44 
public55 

async55 
Task55 
<55 
ActionResult55 "
<55" #
StatementOutDto55# 2
>552 3
>553 4
AddStatement555 A
(55A B
StatementDto55B N
statementDto55O [
)55[ \
{66 
if77 
(77	 

statementDto77
 
.77 
PoliticianId77 #
is77$ &
null77' +
)77+ ,
{88 
return99 
ValidationProblem99  
(99  !
$str99! W
)99W X
;99X Y
}:: 
if;; 
(;;	 

statementDto;;
 
.;; 
Link;; 
is;; 
null;; #
||;;$ &
statementDto;;' 3
.;;3 4
Link;;4 8
.;;8 9
Length;;9 ?
<;;@ A
$num;;B C
);;C D
{<< 
return== 
ValidationProblem==  
(==  !
$str==! A
)==A B
;==B C
}>> 
if?? 
(??	 

statementDto??
 
.?? 
Link?? 
.?? 
Length?? "
>??# $
$num??% (
)??( )
{@@ 
returnAA 
ValidationProblemAA  
(AA  !
$strAA! \
)AA\ ]
;AA] ^
}BB 
ifCC 
(CC	 

statementDtoCC
 
.CC 
TagsCC 
isCC 
nullCC #
||CC$ &
statementDtoCC' 3
.CC3 4
TagsCC4 8
.CC8 9
CountCC9 >
<CC? @
$numCCA B
)CCB C
{DD 
returnEE 
ValidationProblemEE  
(EE  !
$strEE! N
)EEN O
;EEO P
}FF 
varGG 	
existingPoliticianGG
 
=GG 
awaitGG $
_politiciansRepoGG% 5
.GG5 6
GetPoliticianByIdGG6 G
(GGG H
statementDtoGGH T
.GGT U
PoliticianIdGGU a
)GGa b
;GGb c
ifHH 
(HH	 

existingPoliticianHH
 
isHH 
nullHH  $
)HH$ %
{II 
returnJJ 
ValidationProblemJJ  
(JJ  !
$strJJ! C
)JJC D
;JJD E
}KK 
varLL 	
userIdLL
 
=LL 
HttpContextLL 
.LL 
UserLL #
.LL# $
FindFirstValueLL$ 2
(LL2 3

ClaimTypesLL3 =
.LL= >
NameIdentifierLL> L
)LLL M
;LLM N
varMM 	
createdStatementMM
 
=MM 
awaitMM "
_statementsRepoMM# 2
.MM2 3
AddStatementMM3 ?
(MM? @
statementDtoMM@ L
,MML M
userIdMMN T
)MMT U
;MMU V
returnNN 
CreatedAtActionNN 
(NN 
nameofNN #
(NN# $
GetStatetementByIdNN$ 6
)NN6 7
,NN7 8
newNN9 <
{NN= >
idNN? A
=NNB C
createdStatementNND T
.NNT U
StatementIdNNU `
}NNa b
,NNb c
createdStatementNNd t
)NNt u
;NNu v
}OO 
[PP 
	AuthorizePP 
]PP 
[QQ 

HttpDeleteQQ 
(QQ 
$strQQ 
)QQ 
]QQ 
publicRR 

asyncRR 
TaskRR 
<RR 
ActionResultRR "
<RR" #
StatementOutDtoRR# 2
>RR2 3
>RR3 4
DeleteStatementRR5 D
(RRD E
stringRRE K
idRRL N
)RRN O
{SS 
varTT 	
statementToDeleteTT
 
=TT 
awaitTT #
_statementsRepoTT$ 3
.TT3 4"
GetStatementEntityByIdTT4 J
(TTJ K
idTTK M
)TTM N
;TTN O
varUU 	
roleUU
 
=UU 
HttpContextUU 
.UU 
UserUU !
.UU! "
FindFirstValueUU" 0
(UU0 1

ClaimTypesUU1 ;
.UU; <
RoleUU< @
)UU@ A
;UUA B
varVV 	
userIdVV
 
=VV 
HttpContextVV 
.VV 
UserVV #
.VV# $
FindFirstValueVV$ 2
(VV2 3

ClaimTypesVV3 =
.VV= >
NameIdentifierVV> L
)VVL M
;VVM N
ifWW 
(WW	 

roleWW
 
!=WW 
$strWW 
&&WW 
roleWW !
!=WW" $
$strWW% *
&&WW+ -
userIdWW. 4
!=WW5 7
statementToDeleteWW8 I
.WWI J
CreatedByIdWWJ U
)WWU V
{XX 
returnYY 
UnauthorizedYY 
(YY 
)YY 
;YY 
}ZZ 
var[[ 	
deletedStatement[[
 
=[[ 
await[[ "
_statementsRepo[[# 2
.[[2 3
DeleteStatementById[[3 F
([[F G
id[[G I
)[[I J
;[[J K
if\\ 
(\\	 

deletedStatement\\
 
is\\ 
null\\ "
)\\" #
{]] 
return^^ 
ValidationProblem^^  
(^^  !
$str^^! A
)^^A B
;^^B C
}__ 
return`` 
deletedStatement`` 
;`` 
}aa 
[cc 
	Authorizecc 
]cc 
[dd 
HttpPostdd 
(dd 
$strdd 
)dd 
]dd 
publicee 

asyncee 
Taskee 
<ee 
ActionResultee "
>ee" #
LikeStatementee$ 1
(ee1 2
stringee2 8
idee9 ;
)ee; <
{ff 
vargg 	
userIdgg
 
=gg 
HttpContextgg 
.gg 
Usergg #
.gg# $
FindFirstValuegg$ 2
(gg2 3

ClaimTypesgg3 =
.gg= >
NameIdentifiergg> L
)ggL M
;ggM N
varhh 	
userhh
 
=hh 
awaithh 
_authServicehh #
.hh# $
GetUserByIdhh$ /
(hh/ 0
userIdhh0 6
)hh6 7
;hh7 8
ifii 
(ii	 

userii
 
isii 
nullii 
)ii 
{jj 
returnkk 
Unauthorizedkk 
(kk 
)kk 
;kk 
}ll 
ifmm 
(mm	 

(mm
 
awaitmm 
_statementsRepomm  
.mm  !
GetStatementByIdmm! 1
(mm1 2
idmm2 4
)mm4 5
)mm5 6
ismm7 9
nullmm: >
)mm> ?
{nn 
returnoo 
ValidationProblemoo  
(oo  !
$stroo! ;
)oo; <
;oo< =
}pp 
varqq 	
resultqq
 
=qq 
awaitqq 
_statementsRepoqq (
.qq( )
LikeStatementqq) 6
(qq6 7
idqq7 9
,qq9 :
userIdqq; A
)qqA B
;qqB C
ifrr 
(rr	 

resultrr
 
)rr 
{ss 
returntt 
Oktt 
(tt 
)tt 
;tt 
}uu 
returnvv 
ValidationProblemvv 
(vv 
$strvv U
)vvU V
;vvV W
}ww 
[xx 
	Authorizexx 
]xx 
[yy 
HttpPostyy 
(yy 
$stryy 
)yy 
]yy 
publiczz 

asynczz 
Taskzz 
<zz 
ActionResultzz "
>zz" #
UnlikeStatementzz$ 3
(zz3 4
stringzz4 :
idzz; =
)zz= >
{{{ 
var|| 	
userId||
 
=|| 
HttpContext|| 
.|| 
User|| #
.||# $
FindFirstValue||$ 2
(||2 3

ClaimTypes||3 =
.||= >
NameIdentifier||> L
)||L M
;||M N
var}} 	
user}}
 
=}} 
await}} 
_authService}} #
.}}# $
GetUserById}}$ /
(}}/ 0
userId}}0 6
)}}6 7
;}}7 8
if~~ 
(~~	 

user~~
 
is~~ 
null~~ 
)~~ 
{ 
return
ÄÄ 
Unauthorized
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 
if
ÇÇ 
(
ÇÇ	 

(
ÇÇ
 
await
ÇÇ 
_statementsRepo
ÇÇ  
.
ÇÇ  !
GetStatementById
ÇÇ! 1
(
ÇÇ1 2
id
ÇÇ2 4
)
ÇÇ4 5
)
ÇÇ5 6
is
ÇÇ7 9
null
ÇÇ: >
)
ÇÇ> ?
{
ÉÉ 
return
ÑÑ 
ValidationProblem
ÑÑ  
(
ÑÑ  !
$str
ÑÑ! ;
)
ÑÑ; <
;
ÑÑ< =
}
ÖÖ 
var
ÜÜ 	
result
ÜÜ
 
=
ÜÜ 
await
ÜÜ 
_statementsRepo
ÜÜ (
.
ÜÜ( )
UnlikeStatement
ÜÜ) 8
(
ÜÜ8 9
id
ÜÜ9 ;
,
ÜÜ; <
userId
ÜÜ= C
)
ÜÜC D
;
ÜÜD E
if
áá 
(
áá	 

result
áá
 
)
áá 
{
àà 
return
ââ 
Ok
ââ 
(
ââ 
)
ââ 
;
ââ 
}
ää 
return
ãã 
ValidationProblem
ãã 
(
ãã 
$str
ãã R
)
ããR S
;
ããS T
}
åå 
[
çç 
HttpGet
çç 
(
çç 
$str
çç &
)
çç& '
]
çç' (
public
éé 

async
éé 
Task
éé 
<
éé 
ActionResult
éé "
<
éé" #
int
éé# &
>
éé& '
>
éé' (#
GetStatementLikeCount
éé) >
(
éé> ?
string
éé? E
statementId
ééF Q
)
ééQ R
{
èè 
var
êê 	
	statement
êê
 
=
êê 
await
êê 
_statementsRepo
êê +
.
êê+ ,$
GetStatementEntityById
êê, B
(
êêB C
statementId
êêC N
)
êêN O
;
êêO P
if
ëë 
(
ëë	 

	statement
ëë
 
is
ëë 
null
ëë 
)
ëë 
{
íí 
return
ìì 
ValidationProblem
ìì  
(
ìì  !
$str
ìì! F
)
ììF G
;
ììG H
}
îî 
var
ïï 	
count
ïï
 
=
ïï 
_statementsRepo
ïï !
.
ïï! "
GetLikeCount
ïï" .
(
ïï. /
statementId
ïï/ :
)
ïï: ;
;
ïï; <
return
óó 
Ok
óó 
(
óó 
count
óó 
)
óó 
;
óó 
}
òò 
[
ôô 
HttpGet
ôô 
(
ôô 
$str
ôô %
)
ôô% &
]
ôô& '
public
öö 

async
öö 
Task
öö 
<
öö 
ActionResult
öö "
<
öö" #
bool
öö# '
>
öö' (
>
öö( )(
CheckIfCurrentUserHasLiked
öö* D
(
ööD E
string
ööE K
statementId
ööL W
)
ööW X
{
õõ 
var
úú 	
userId
úú
 
=
úú 
HttpContext
úú 
.
úú 
User
úú #
.
úú# $
FindFirstValue
úú$ 2
(
úú2 3

ClaimTypes
úú3 =
.
úú= >
NameIdentifier
úú> L
)
úúL M
;
úúM N
var
ùù 	
user
ùù
 
=
ùù 
await
ùù 
_authService
ùù #
.
ùù# $
GetUserById
ùù$ /
(
ùù/ 0
userId
ùù0 6
)
ùù6 7
;
ùù7 8
if
ûû 
(
ûû	 

user
ûû
 
is
ûû 
null
ûû 
)
ûû 
{
üü 
return
†† 
Unauthorized
†† 
(
†† 
)
†† 
;
†† 
}
°° 
var
¢¢ 	
	statement
¢¢
 
=
¢¢ 
await
¢¢ 
_statementsRepo
¢¢ +
.
¢¢+ ,$
GetStatementEntityById
¢¢, B
(
¢¢B C
statementId
¢¢C N
)
¢¢N O
;
¢¢O P
if
££ 
(
££	 

	statement
££
 
is
££ 
null
££ 
)
££ 
{
§§ 
return
•• 
ValidationProblem
••  
(
••  !
$str
••! F
)
••F G
;
••G H
}
¶¶ 
var
ßß 	
hasLiked
ßß
 
=
ßß 
await
ßß 
_statementsRepo
ßß *
.
ßß* +!
CheckIfUserHasLiked
ßß+ >
(
ßß> ?
statementId
ßß? J
,
ßßJ K
userId
ßßL R
)
ßßR S
;
ßßS T
return
®® 
Ok
®® 
(
®® 
hasLiked
®® 
)
®® 
;
®® 
}
©© 
}
™™ 
public
¨¨ 
class
¨¨	 
StatementsParams
¨¨ 
:
¨¨  !
PaginationParams
¨¨" 2
{
≠≠ 
public
ÆÆ 

string
ÆÆ 
?
ÆÆ 

Politician
ÆÆ 
{
ÆÆ 
get
ÆÆ  #
;
ÆÆ# $
set
ÆÆ% (
;
ÆÆ( )
}
ÆÆ* +
public
ØØ 

List
ØØ 
<
ØØ 
string
ØØ 
>
ØØ 
?
ØØ 
Tags
ØØ 
{
ØØ 
get
ØØ  #
;
ØØ# $
set
ØØ% (
;
ØØ( )
}
ØØ* +
}
∞∞ 
}±± ˜
;D:\Programavimas\politik\back\Controllers\TagsController.cs
	namespace		 	
Politics		
 
.		 
Controllers		 
{

 
[ 
Route 
( 	
$str	 
) 
] 
[ 
ApiController 
] 
public 
class	 
TagsController 
: 
ControllerBase  .
{ 
private 
readonly 
ITagsRepository $
_repo% *
;* +
public 

TagsController 
( 
ITagsRepository )
repo* .
). /
{ 
_repo 
= 
repo 
; 
} 
[ 
HttpGet 
] 
public 

async 
Task 
< 
ActionResult "
<" #
List# '
<' (
	TagOutDto( 1
>1 2
>2 3
>3 4

GetAllTags5 ?
(? @
)@ A
{ 
return 
Ok 
( 
await 
_repo 
. 

GetAllTags &
(& '
)' (
)( )
;) *
} 
[ 
	Authorize 
] 
[ 
HttpPost 
] 
public 

async 
Task 
< 
ActionResult "
<" #
	TagOutDto# ,
>, -
>- .
AddTag/ 5
(5 6
TagDto6 <
tagDto= C
)C D
{ 
var 	
userId
 
= 
HttpContext 
. 
User #
.# $
FindFirstValue$ 2
(2 3

ClaimTypes3 =
.= >
NameIdentifier> L
)L M
;M N
return   
Ok   
(   
await   
_repo   
.   
AddTag   "
(  " #
tagDto  # )
,  ) *
userId  + 1
)  1 2
)  2 3
;  3 4
}!! 
["" 
	Authorize"" 
]"" 
[## 

HttpDelete## 
(## 
$str## 
)## 
]## 
public$$ 

async$$ 
Task$$ 
<$$ 
ActionResult$$ "
>$$" #
	RemoveTag$$$ -
($$- .
string$$. 4
id$$5 7
)$$7 8
{%% 
var&& 	
tagToDelete&&
 
=&& 
await&& 
_repo&& #
.&&# $
GetTagEntityById&&$ 4
(&&4 5
id&&5 7
)&&7 8
;&&8 9
var'' 	
role''
 
='' 
HttpContext'' 
.'' 
User'' !
.''! "
FindFirstValue''" 0
(''0 1

ClaimTypes''1 ;
.''; <
Role''< @
)''@ A
;''A B
var(( 	
userId((
 
=(( 
HttpContext(( 
.(( 
User(( #
.((# $
FindFirstValue(($ 2
(((2 3

ClaimTypes((3 =
.((= >
NameIdentifier((> L
)((L M
;((M N
if)) 
())	 

role))
 
!=)) 
$str)) 
&&)) 
role)) !
!=))" $
$str))% *
&&))+ -
userId)). 4
!=))5 7
tagToDelete))8 C
.))C D
CreatedById))D O
)))O P
{** 
return++ 
Unauthorized++ 
(++ 
)++ 
;++ 
},, 
await-- 
_repo-- 
.-- 
	DeleteTag-- 
(-- 
id-- 
)-- 
;--  
return.. 
	NoContent.. 
(.. 
).. 
;.. 
}// 
}00 
}11 †
8D:\Programavimas\politik\back\Data\IPartiesRepository.cs
	namespace 	
Politics
 
. 
Data 
{ 
public 
	interface	 
IPartiesRepository %
{ 
Task		 
<		 	
List			 
<		 
PartyOutDto		 
>		 
>		 
GetAllParties		 )
(		) *
)		* +
;		+ ,
Task

 
<

 	
PartyOutDto

	 
>

 
GetPartyById

 "
(

" #
string

# )
id

* ,
)

, -
;

- .
Task 
< 	
PartyOutDto	 
> 
AddParty 
( 
PartyDto '
partyDto( 0
,0 1
string2 8
userId9 ?
)? @
;@ A
Task 
< 	
PartyOutDto	 
> 
DeleteParty !
(! "
string" (
id) +
)+ ,
;, -
} 
} µ
<D:\Programavimas\politik\back\Data\IPoliticiansRepository.cs
	namespace 	
Politics
 
. 
Data 
{ 
public 
	interface	 "
IPoliticiansRepository )
{ 
Task		 
<		 	
PoliticianOutDto			 
>		 
AddPolitician		 (
(		( )
PoliticianDto		) 6
politicianDto		7 D
,		D E
string		F L
userId		M S
)		S T
;		T U
Task

 
<

 	
PaginatedList

	 
<

 
PoliticianOutDto

 '
>

' (
>

( )
GetAllPoliticians

* ;
(

; <
int

< ?
?

? @

pageNumber

A K
,

K L
int

M P
?

P Q
pageSize

R Z
,

Z [
string

\ b
?

b c
partyId

d k
,

k l
string

m s
?

s t
search

u {
)

{ |
;

| }
Task 
< 	
PoliticianOutDto	 
> 
DeletePolitician +
(+ ,
string, 2
id3 5
)5 6
;6 7
Task 
< 	
PoliticianOutDto	 
> 
UpdatePolitician +
(+ ,
string, 2
politicianId3 ?
,? @
UpdatePoliticianDtoA T
politicianDtoU b
,b c
stringd j
userIdk q
)q r
;r s
Task 
< 	
PoliticianOutDto	 
> 
GetPoliticianById ,
(, -
string- 3
id4 6
)6 7
;7 8
} 
} Ô
8D:\Programavimas\politik\back\Data\IReportsRepository.cs
	namespace 	
Politics
 
. 
Data 
{ 
public 
	interface	 
IReportsRepository %
{ 
Task		 
<		 	
List			 
<		 
ReportOutDto		 
>		 
>		 

GetReports		 '
(		' (
int		( +
?		+ ,

pageNumber		- 7
,		7 8
int		9 <
?		< =
pageSize		> F
,		F G
bool		H L
?		L M

isReviewed		N X
)		X Y
;		Y Z
Task

 
<

 	
ReportOutDto

	 
>

 
GenerateReport

 %
(

% &
	ReportDto

& /
	reportDto

0 9
,

9 :
string

; A
userId

B H
)

H I
;

I J
Task 
< 	
bool	 
> 
ReviewReport 
( 
string "
reportId# +
,+ ,
string- 3
userId4 :
): ;
;; <
} 
} ±
;D:\Programavimas\politik\back\Data\IStatementsRepository.cs
	namespace 	
Politics
 
. 
Data 
{ 
public		 
	interface			 !
IStatementsRepository		 (
{

 
Task 
< 	
PaginatedList	 
< 
StatementOutDto &
>& '
>' (
GetAllStatements) 9
(9 :
string: @
?@ A
politicianIdB N
,N O
ListP T
<T U
stringU [
>[ \
?\ ]
tagIds^ d
,d e
intf i
?i j

pageNumberk u
,u v
intw z
?z {
pageSize	| Ñ
)
Ñ Ö
;
Ö Ü
Task 
< 	
StatementOutDto	 
> 
GetStatementById *
(* +
string+ 1
id2 4
)4 5
;5 6
Task 
< 	
StatementOutDto	 
> 
AddStatement &
(& '
StatementDto' 3
statementDto4 @
,@ A
stringB H
userIdI O
)O P
;P Q
Task 
< 	
StatementOutDto	 
> 
DeleteStatementById -
(- .
string. 4
id5 7
)7 8
;8 9
Task 
< 	
	Statement	 
> "
GetStatementEntityById *
(* +
string+ 1
id2 4
)4 5
;5 6
Task 
< 	
bool	 
> 
LikeStatement 
( 
string #
statementId$ /
,/ 0
string1 7
userId8 >
)> ?
;? @
Task 
< 	
bool	 
> 
UnlikeStatement 
( 
string %
statementId& 1
,1 2
string3 9
userId: @
)@ A
;A B
Task 
< 	
bool	 
> 
CheckIfUserHasLiked "
(" #
string# )
statementId* 5
,5 6
string7 =
userId> D
)D E
;E F
int 
GetLikeCount 
( 
string 
statementId '
)' (
;( )
} 
} –
5D:\Programavimas\politik\back\Data\ITagsRepository.cs
	namespace 	
Politics
 
. 
Data 
{ 
public 
	interface	 
ITagsRepository "
{		 
Task

 
<

 	
List

	 
<

 
	TagOutDto

 
>

 
>

 

GetAllTags

 $
(

$ %
)

% &
;

& '
Task 
< 	
Tag	 
> 
GetTagEntityById 
( 
string %
id& (
)( )
;) *
Task 
< 	
	TagOutDto	 
> 
AddTag 
( 
TagDto !
tagDto" (
,( )
string* 0
userId1 7
)7 8
;8 9
Task 
	DeleteTag	 
( 
string 
id 
) 
; 
} 
} ¶,
7D:\Programavimas\politik\back\Data\PartiesRepository.cs
	namespace		 	
Politics		
 
.		 
Data		 
{

 
public 
class	 
PartiesRepository  
:! "
IPartiesRepository# 5
{ 
private 
readonly 
PoliticsDbContext &
_context' /
;/ 0
private 
readonly 
IMapper 
_mapper $
;$ %
public 

PartiesRepository 
( 
PoliticsDbContext .
context/ 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
PartyOutDto !
>! "
AddParty# +
(+ ,
PartyDto, 4
partyDto5 =
,= >
string? E
userIdF L
)L M
{ 
var 	
party
 
= 
_mapper 
. 
Map 
< 
PartyDto &
,& '
Party( -
>- .
(. /
partyDto/ 7
)7 8
;8 9
party 
. 
PartyId 
= 
Guid 
. 
NewGuid "
(" #
)# $
.$ %
ToString% -
(- .
). /
;/ 0
party 
. 
	CreatedAt 
= 
DateTime  
.  !
Now! $
;$ %
party 
. 
CreatedById 
= 
userId  
;  !
await 
_context 
. 
AddAsync 
( 
party #
)# $
;$ %
await 
_context 
. 
SaveChangesAsync %
(% &
)& '
;' (
var 	

addedParty
 
= 
await 
_context %
.% &
Parties& -
.- .
	FindAsync. 7
(7 8
party8 =
.= >
PartyId> E
)E F
;F G
if 
(	 


addedParty
 
is 
null 
) 
{ 
return 
null 
; 
}   
return!! 
_mapper!! 
.!! 
Map!! 
<!! 
Party!! 
,!! 
PartyOutDto!!  +
>!!+ ,
(!!, -

addedParty!!- 7
)!!7 8
;!!8 9
}"" 
public$$ 

async$$ 
Task$$ 
<$$ 
PartyOutDto$$ !
>$$! "
DeleteParty$$# .
($$. /
string$$/ 5
id$$6 8
)$$8 9
{%% 
var&& 	
party&&
 
=&& 
await&& 
_context&&  
.&&  !
Parties&&! (
.&&( )
	FindAsync&&) 2
(&&2 3
id&&3 5
)&&5 6
;&&6 7
if'' 
(''	 

party''
 
is'' 
null'' 
)'' 
{(( 
return)) 
null)) 
;)) 
}** 
_context++ 
.++ 
Remove++ 
(++ 
party++ 
)++ 
;++ 
await,, 
_context,, 
.,, 
SaveChangesAsync,, %
(,,% &
),,& '
;,,' (
return-- 
_mapper-- 
.-- 
Map-- 
<-- 
Party-- 
,-- 
PartyOutDto--  +
>--+ ,
(--, -
party--- 2
)--2 3
;--3 4
}.. 
public00 

async00 
Task00 
<00 
List00 
<00 
PartyOutDto00 &
>00& '
>00' (
GetAllParties00) 6
(006 7
)007 8
{11 
var22 	
parties22
 
=22 
await22 
_context22 "
.22" #
Parties22# *
.22* +
ToListAsync22+ 6
(226 7
)227 8
;228 9
return33 
_mapper33 
.33 
Map33 
<33 
List33 
<33 
Party33 #
>33# $
,33$ %
List33& *
<33* +
PartyOutDto33+ 6
>336 7
>337 8
(338 9
parties339 @
)33@ A
;33A B
}44 
public66 

async66 
Task66 
<66 
PartyOutDto66 !
>66! "
GetPartyById66# /
(66/ 0
string660 6
id667 9
)669 :
{77 
var88 	
party88
 
=88 
await88 
_context88  
.88  !
Parties88! (
.88( )
	FindAsync88) 2
(882 3
id883 5
)885 6
;886 7
if99 
(99	 

party99
 
is99 
not99 
null99 
)99 
{:: 
return;; 
_mapper;; 
.;; 
Map;; 
<;; 
Party;;  
,;;  !
PartyOutDto;;" -
>;;- .
(;;. /
party;;/ 4
);;4 5
;;;5 6
}<< 
return== 
null== 
;== 
}>> 
}?? 
}@@ ˘_
;D:\Programavimas\politik\back\Data\PoliticiansRepository.cs
	namespace

 	
Politics


 
.

 
Data

 
{ 
public 
class	 !
PoliticiansRepository $
:% &"
IPoliticiansRepository' =
{ 
private 
readonly 
PoliticsDbContext &
_context' /
;/ 0
private 
readonly 
IMapper 
_mapper $
;$ %
public 
!
PoliticiansRepository  
(  !
PoliticsDbContext! 2
context3 :
,: ;
IMapper< C
mapperD J
)J K
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
PaginatedList #
<# $
PoliticianOutDto$ 4
>4 5
>5 6
GetAllPoliticians7 H
(H I
intI L
?L M

pageNumberN X
,X Y
intZ ]
?] ^
pageSize_ g
,g h
stringi o
?o p
partyIdq x
,x y
string	z Ä
?
Ä Å
search
Ç à
)
à â
{ 
var 	
politicians
 
= 
_context  
.  !
Politicians! ,
., -
Include- 4
(4 5

politician5 ?
=>@ B

politicianC M
.M N
PartyN S
)S T
;T U
if 
(	 

partyId
 
is 
not 
null 
) 
{ 
if 

( 
partyId 
!= 
$str 
) 
{ 	
politicians
 
= 
politicians #
.# $
Where$ )
() *

politician* 4
=>5 7

politician8 B
.B C
PartyIdC J
==K M
partyIdN U
)U V
.V W
IncludeW ^
(^ _

politician_ i
=>j l

politicianm w
.w x
Partyx }
)} ~
;~ 
} 	
else
 
{   	
politicians!!
 
=!! 
politicians!! #
.!!# $
Where!!$ )
(!!) *

politician!!* 4
=>!!5 7

politician!!8 B
.!!B C
PartyId!!C J
==!!K M
null!!N R
)!!R S
.!!S T
Include!!T [
(!![ \

politician!!\ f
=>!!g i

politician!!j t
.!!t u
Party!!u z
)!!z {
;!!{ |
;!!} ~
}"" 	
}## 
if$$ 
($$	 

search$$
 
is$$ 
not$$ 
null$$ 
)$$ 
{%% 
var&& 
lowercaseSearch&& 
=&& 
search&& $
.&&$ %
ToLower&&% ,
(&&, -
)&&- .
;&&. /
politicians'' 
='' 
politicians'' !
.''! "
Where''" '
(''' (

politician''( 2
=>''3 5
(''6 7
(((
 

politician(( 
.(( 
	FirstName(( 
.((  
ToLower((  '
(((' (
)((( )
+((* +
$char((, /
+((0 1

politician((1 ;
.((; <
LastName((< D
.((D E
ToLower((E L
(((L M
)((M N
)((N O
.((O P
Contains((P X
(((X Y
lowercaseSearch((Y h
)((h i
||((j l

politician))
 
.)) 
Description))  
.))  !
ToLower))! (
())( )
)))) *
.))* +
Contains))+ 3
())3 4
lowercaseSearch))4 C
)))C D
)** 	
)**	 

.**
 
Include** 
(** 

politician** 
=>**  

politician**! +
.**+ ,
Party**, 1
)**1 2
;**2 3
}++ 
var,, 	 
paginatedPoliticians,,
 
=,,  
await,,! &
PaginatedList,,' 4
<,,4 5

Politician,,5 ?
>,,? @
.,,@ A
CreateAsync,,A L
(,,L M
politicians,,M X
,,,X Y

pageNumber,,Z d
??,,e g
$num,,h i
,,,i j
pageSize,,k s
??,,t v
$num,,w y
),,y z
;,,z {
return-- 
_mapper-- 
.-- 
Map-- 
<-- 
PaginatedList-- &
<--& '

Politician--' 1
>--1 2
,--2 3
PaginatedList--4 A
<--A B
PoliticianOutDto--B R
>--R S
>--S T
(--T U 
paginatedPoliticians--U i
)--i j
;--j k
}.. 
public00 

async00 
Task00 
<00 
PoliticianOutDto00 &
>00& '
GetPoliticianById00( 9
(009 :
string00: @
id00A C
)00C D
{11 
var22 	

politician22
 
=22 
await22 
_context22 %
.22% &
Politicians22& 1
.221 2
Include222 9
(229 :

politician22: D
=>22E G

politician22H R
.22R S
Party22S X
)22X Y
.22Y Z
FirstOrDefaultAsync22Z m
(22m n
p22n o
=>22p r
p22s t
.22t u
PoliticianId	22u Å
==
22Ç Ñ
id
22Ö á
)
22á à
;
22à â
if33 
(33	 


politician33
 
is33 
null33 
)33 
{44 
return55 
null55 
;55 
}66 
return77 
_mapper77 
.77 
Map77 
<77 

Politician77 #
,77# $
PoliticianOutDto77% 5
>775 6
(776 7

politician777 A
)77A B
;77B C
}88 
public:: 

async:: 
Task:: 
<:: 
PoliticianOutDto:: &
>::& '
AddPolitician::( 5
(::5 6
PoliticianDto::6 C
politicianDto::D Q
,::Q R
string::S Y
userId::Z `
)::` a
{;; 
var<< 	

politician<<
 
=<< 
_mapper<< 
.<< 
Map<< "
<<<" #
PoliticianDto<<# 0
,<<0 1

Politician<<2 <
><<< =
(<<= >
politicianDto<<> K
)<<K L
;<<L M

politician== 
.== 
PoliticianId== 
=== 
Guid==  $
.==$ %
NewGuid==% ,
(==, -
)==- .
.==. /
ToString==/ 7
(==7 8
)==8 9
;==9 :

politician>> 
.>> 
	CreatedAt>> 
=>> 
DateTime>> %
.>>% &
Now>>& )
;>>) *

politician?? 
.?? 
CreatedById?? 
=?? 
userId?? %
;??% &
if@@ 
(@@	 


politician@@
 
.@@ 
PartyId@@ 
is@@ 
not@@  #
null@@$ (
)@@( )
{AA 
varBB 
partyBB 
=BB 
awaitBB 
_contextBB "
.BB" #
PartiesBB# *
.BB* +
	FindAsyncBB+ 4
(BB4 5

politicianBB5 ?
.BB? @
PartyIdBB@ G
)BBG H
;BBH I
ifCC 

(CC 
partyCC 
isCC 
nullCC 
)CC 
{DD 	
returnEE
 
nullEE 
;EE 
}FF 	

politicianGG 
.GG 
PartyGG 
=GG 
partyGG  
;GG  !
}HH 
awaitII 
_contextII 
.II 
PoliticiansII  
.II  !
AddAsyncII! )
(II) *

politicianII* 4
)II4 5
;II5 6
awaitJJ 
_contextJJ 
.JJ 
SaveChangesAsyncJJ %
(JJ% &
)JJ& '
;JJ' (
varLL 	
createdPoliticianLL
 
=LL 
awaitLL #
_contextLL$ ,
.LL, -
PoliticiansLL- 8
.LL8 9
	FindAsyncLL9 B
(LLB C

politicianLLC M
.LLM N
PoliticianIdLLN Z
)LLZ [
;LL[ \
ifMM 
(MM	 

createdPoliticianMM
 
isMM 
nullMM #
)MM# $
{NN 
returnOO 
nullOO 
;OO 
}PP 
returnQQ 
_mapperQQ 
.QQ 
MapQQ 
<QQ 

PoliticianQQ #
,QQ# $
PoliticianOutDtoQQ% 5
>QQ5 6
(QQ6 7
createdPoliticianQQ7 H
)QQH I
;QQI J
}RR 
publicTT 

asyncTT 
TaskTT 
<TT 
PoliticianOutDtoTT &
>TT& '
UpdatePoliticianTT( 8
(TT8 9
stringTT9 ?
politicianIdTT@ L
,TTL M
UpdatePoliticianDtoTTN a
politicianDtoTTb o
,TTo p
stringTTq w
userIdTTx ~
)TT~ 
{UU 
varVV 	

politicianVV
 
=VV 
awaitVV 
_contextVV %
.VV% &
PoliticiansVV& 1
.VV1 2
IncludeVV2 9
(VV9 :

politicianVV: D
=>VVE G

politicianVVH R
.VVR S
PartyVVS X
)VVX Y
.VVY Z
FirstOrDefaultAsyncVVZ m
(VVm n

politicianVVn x
=>VVy {

politician	VV| Ü
.
VVÜ á
PoliticianId
VVá ì
==
VVî ñ
politicianId
VVó £
)
VV£ §
;
VV§ •

politicianWW 
.WW 
PartyIdWW 
=WW 
politicianDtoWW (
.WW( )
PartyIdWW) 0
;WW0 1

politicianXX 
.XX 
DescriptionXX 
=XX 
politicianDtoXX ,
.XX, -
DescriptionXX- 8
;XX8 9

politicianYY 
.YY 
UpdatedByIdYY 
=YY 
userIdYY %
;YY% &

politicianZZ 
.ZZ 
	UpdatedAtZZ 
=ZZ 
DateTimeZZ %
.ZZ% &
NowZZ& )
;ZZ) *
await[[ 
_context[[ 
.[[ 
SaveChangesAsync[[ %
([[% &
)[[& '
;[[' (
return\\ 
_mapper\\ 
.\\ 
Map\\ 
<\\ 

Politician\\ #
,\\# $
PoliticianOutDto\\% 5
>\\5 6
(\\6 7

politician\\7 A
)\\A B
;\\B C
}]] 
public__ 

async__ 
Task__ 
<__ 
PoliticianOutDto__ &
>__& '
DeletePolitician__( 8
(__8 9
string__9 ?
id__@ B
)__B C
{`` 
varaa 	

politicianaa
 
=aa 
awaitaa 
_contextaa %
.aa% &
Politiciansaa& 1
.aa1 2
	FindAsyncaa2 ;
(aa; <
idaa< >
)aa> ?
;aa? @
ifbb 
(bb	 


politicianbb
 
isbb 
nullbb 
)bb 
{cc 
returndd 
nulldd 
;dd 
}ee 
_contextff 
.ff 
Politiciansff 
.ff 
Removeff !
(ff! "

politicianff" ,
)ff, -
;ff- .
awaitgg 
_contextgg 
.gg 
SaveChangesAsyncgg %
(gg% &
)gg& '
;gg' (
returnhh 
_mapperhh 
.hh 
Maphh 
<hh 

Politicianhh #
,hh# $
PoliticianOutDtohh% 5
>hh5 6
(hh6 7

politicianhh7 A
)hhA B
;hhB C
}ii 
}jj 
}kk ï1
7D:\Programavimas\politik\back\Data\ReportsRepository.cs
	namespace

 	
Politics


 
.

 
Data

 
{ 
public 
class	 
ReportsRepository  
:! "
IReportsRepository# 5
{ 
private 
readonly 
PoliticsDbContext &
_context' /
;/ 0
private 
readonly 
IMapper 
_mapper $
;$ %
public 

ReportsRepository 
( 
PoliticsDbContext .
context/ 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
List 
< 
ReportOutDto '
>' (
>( )

GetReports* 4
(4 5
int5 8
?8 9

pageNumber: D
,D E
intF I
?I J
pageSizeK S
,S T
boolU Y
?Y Z

isReviewed[ e
)e f
{ 
var 	
reports
 
= 
_context 
. 
Reports $
.$ %
Include% ,
(, -
report- 3
=>4 6
report7 =
.= >
	CreatedBy> G
)G H
.H I
IncludeI P
(P Q
reportQ W
=>X Z
report[ a
.a b

ReviewedByb l
)l m
;m n
var 	
paginatedReports
 
= 
await "
PaginatedList# 0
<0 1
Report1 7
>7 8
.8 9
CreateAsync9 D
(D E
reportsE L
,L M

pageNumberN X
??Y [
$num\ ]
,] ^
pageSize_ g
??h j
$numk m
)m n
;n o
return 
_mapper 
. 
Map 
< 
PaginatedList &
<& '
Report' -
>- .
,. /
PaginatedList0 =
<= >
ReportOutDto> J
>J K
>K L
(L M
paginatedReportsM ]
)] ^
;^ _
} 
public 

async 
Task 
< 
ReportOutDto "
>" #
GenerateReport$ 2
(2 3
	ReportDto3 <
	reportDto= F
,F G
stringH N
userIdO U
)U V
{ 
var   	
report  
 
=   
_mapper   
.   
Map   
<   
	ReportDto   (
,  ( )
Report  * 0
>  0 1
(  1 2
	reportDto  2 ;
)  ; <
;  < =
report!! 
.!! 
ReportId!! 
=!! 
Guid!! 
.!! 
NewGuid!! $
(!!$ %
)!!% &
.!!& '
ToString!!' /
(!!/ 0
)!!0 1
;!!1 2
report"" 
."" 

IsReviewed"" 
="" 
false"" 
;""  
report## 
.## 
CreatedById## 
=## 
userId## !
;##! "
await$$ 
_context$$ 
.$$ 
Reports$$ 
.$$ 
AddAsync$$ %
($$% &
report$$& ,
)$$, -
;$$- .
await%% 
_context%% 
.%% 
SaveChangesAsync%% %
(%%% &
)%%& '
;%%' (
var&& 	
generatedReport&&
 
=&& 
await&& !
_context&&" *
.&&* +
Reports&&+ 2
.&&2 3
Include&&3 :
(&&: ;
report&&; A
=>&&B D
report&&E K
.&&K L
	CreatedBy&&L U
)&&U V
.&&V W 
SingleOrDefaultAsync&&W k
(&&k l
rep&&l o
=>&&p r
rep&&s v
.&&v w
ReportId&&w 
==
&&Ä Ç
report
&&É â
.
&&â ä
ReportId
&&ä í
)
&&í ì
;
&&ì î
return'' 
_mapper'' 
.'' 
Map'' 
<'' 
Report'' 
,''  
ReportOutDto''! -
>''- .
(''. /
generatedReport''/ >
)''> ?
;''? @
}(( 
public)) 

async)) 
Task)) 
<)) 
bool)) 
>)) 
ReviewReport)) (
())( )
string))) /
reportId))0 8
,))8 9
string)): @
userId))A G
)))G H
{** 
var++ 	
report++
 
=++ 
await++ 
_context++ !
.++! "
Reports++" )
.++) *
FirstOrDefaultAsync++* =
(++= >
report++> D
=>++E G
report++H N
.++N O
ReportId++O W
==++X Z
reportId++[ c
)++c d
;++d e
var,, 	
user,,
 
=,, 
await,, 
_context,, 
.,,  
Users,,  %
.,,% &
FirstOrDefaultAsync,,& 9
(,,9 :
user,,: >
=>,,? A
user,,B F
.,,F G
UserId,,G M
==,,N P
userId,,Q W
),,W X
;,,X Y
if-- 
(--	 

user--
 
is-- 
null-- 
||-- 
report--  
is--! #
null--$ (
)--( )
{.. 
return// 
false// 
;// 
}00 
report11 
.11 

IsReviewed11 
=11 
true11 
;11 
report22 
.22 

ReviewedBy22 
=22 
user22 
;22 
await33 
_context33 
.33 
SaveChangesAsync33 %
(33% &
)33& '
;33' (
return44 
true44 
;44 
}55 
}66 
}77 ∫õ
:D:\Programavimas\politik\back\Data\StatementsRepository.cs
	namespace 	
Politics
 
. 
Data 
{ 
public 
class	  
StatementsRepository #
:$ %!
IStatementsRepository& ;
{ 
private 
readonly 
PoliticsDbContext &
_context' /
;/ 0
private 
readonly 
IMapper 
_mapper $
;$ %
private 
readonly 
ITagsRepository $
	_tagsRepo% .
;. /
public 
 
StatementsRepository 
(  
PoliticsDbContext  1
context2 9
,9 :
IMapper; B
mapperC I
,I J
ITagsRepositoryK Z
tagsRepo[ c
)c d
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
	_tagsRepo 
= 
tagsRepo 
; 
} 
public 

async 
Task 
< 
StatementOutDto %
>% &
AddStatement' 3
(3 4
StatementDto4 @
statementDtoA M
,M N
stringO U
userIdV \
)\ ]
{ 
var 	
	statement
 
= 
_mapper 
. 
Map !
<! "
StatementDto" .
,. /
	Statement0 9
>9 :
(: ;
statementDto; G
)G H
;H I
	statement 
. 
StatementId 
= 
Guid "
." #
NewGuid# *
(* +
)+ ,
., -
ToString- 5
(5 6
)6 7
;7 8
	statement 
. 
	CreatedAt 
= 
DateTime $
.$ %
Now% (
;( )
	statement 
. 
CreatedById 
= 
userId $
;$ %
await   
_context   
.   

Statements   
.    
AddAsync    (
(  ( )
	statement  ) 2
)  2 3
;  3 4
var"" 	
statementTags""
 
="" 
new"" 
List"" "
<""" #
StatementTag""# /
>""/ 0
(""0 1
)""1 2
;""2 3
statementDto## 
.## 
Tags## 
.## 
ForEach## 
(##  
tag##  #
=>##$ &
{$$ 
if%% 

(%% 
tag%% 
.%% 
TagId%% 
is%% 
null%% 
)%% 
{&& 	
var''
 
newTag'' 
='' 
_mapper'' 
.'' 
Map'' "
<''" #
	TagOutDto''# ,
,'', -
TagDto''. 4
>''4 5
(''5 6
tag''6 9
)''9 :
;'': ;
var((
 

addTagTask(( 
=(( 
Task(( 
.((  
Run((  #
<((# $
	TagOutDto(($ -
>((- .
(((. /
async((/ 4
(((5 6
)((6 7
=>((8 :
await((; @
	_tagsRepo((A J
.((J K
AddTag((K Q
(((Q R
newTag((R X
,((X Y
userId((Z `
)((` a
)((a b
;((b c
var))
 
addedTag)) 
=)) 

addTagTask)) #
.))# $
Result))$ *
;))* +
statementTags**
 
.** 
Add** 
(** 
new** 
StatementTag**  ,
(**, -
)**- .
{++
 
StatementTagId,, 
=,, 
Guid,, !
.,,! "
NewGuid,," )
(,,) *
),,* +
.,,+ ,
ToString,,, 4
(,,4 5
),,5 6
,,,6 7
TagId-- 
=-- 
addedTag-- 
.-- 
TagId-- "
,--" #
StatementId.. 
=.. 
	statement.. #
...# $
StatementId..$ /
}//
 
)// 
;// 
}00 	
else00
 
{11 	
statementTags22
 
.22 
Add22 
(22 
new22 
StatementTag22  ,
(22, -
)22- .
{33
 
StatementTagId44 
=44 
Guid44 !
.44! "
NewGuid44" )
(44) *
)44* +
.44+ ,
ToString44, 4
(444 5
)445 6
,446 7
TagId55 
=55 
tag55 
.55 
TagId55 
,55 
StatementId66 
=66 
	statement66 #
.66# $
StatementId66$ /
}77
 
)77 
;77 
}88 	
}99 
)99 
;99 	
await;; 
_context;; 
.;; 
StatementTags;; "
.;;" #
AddRangeAsync;;# 0
(;;0 1
statementTags;;1 >
);;> ?
;;;? @
await<< 
_context<< 
.<< 
SaveChangesAsync<< %
(<<% &
)<<& '
;<<' (
var== 	
createdStatement==
 
=== 
await== "
_context==# +
.==+ ,

Statements==, 6
.==6 7
	FindAsync==7 @
(==@ A
	statement==A J
.==J K
StatementId==K V
)==V W
;==W X
return>> 
_mapper>> 
.>> 
Map>> 
<>> 
	Statement>> "
,>>" #
StatementOutDto>>$ 3
>>>3 4
(>>4 5
createdStatement>>5 E
)>>E F
;>>F G
}?? 
publicAA 

asyncAA 
TaskAA 
<AA 
PaginatedListAA #
<AA# $
StatementOutDtoAA$ 3
>AA3 4
>AA4 5
GetAllStatementsAA6 F
(AAF G
stringAAG M
?AAM N
politicianIdAAO [
,AA[ \
ListAA] a
<AAa b
stringAAb h
>AAh i
?AAi j
tagsAAk o
,AAo p
intAAq t
?AAt u

pageNumber	AAv Ä
,
AAÄ Å
int
AAÇ Ö
?
AAÖ Ü
pageSize
AAá è
)
AAè ê
{BB 

IQueryableCC 
<CC 
	StatementCC 
>CC 

statementsCC &
;CC& '
ifDD 
(DD	 

politicianIdDD
 
isDD 
notDD 
nullDD "
)DD" #
{EE 

statementsFF 
=FF 
_contextFF 
.FF 

StatementsFF (
.GG 	
WhereGG	 
(GG 
	statementGG 
=>GG 
	statementGG %
.GG% &
PoliticianIdGG& 2
==GG3 5
politicianIdGG6 B
)GGB C
.HH 	
IncludeHH	 
(HH 
	statementHH 
=>HH 
	statementHH '
.HH' (
	CreatedByHH( 1
)HH1 2
.II 	
IncludeII	 
(II 
	statementII 
=>II 
	statementII '
.II' (

PoliticianII( 2
)II2 3
.JJ 	
IncludeJJ	 
(JJ 
	statementJJ 
=>JJ 
	statementJJ '
.JJ' (
StatementTagsJJ( 5
)JJ5 6
.KK 	
ThenIncludeKK	 
(KK 
statementTagKK !
=>KK" $
statementTagKK% 1
.KK1 2
TagKK2 5
)KK5 6
;KK6 7
}LL 
elseLL 
{MM 

statementsNN 
=NN 
_contextNN 
.NN 

StatementsNN (
.OO 	
IncludeOO	 
(OO 
	statementOO 
=>OO 
	statementOO '
.OO' (
	CreatedByOO( 1
)OO1 2
.PP 	
IncludePP	 
(PP 
	statementPP 
=>PP 
	statementPP '
.PP' (

PoliticianPP( 2
)PP2 3
.QQ 	
IncludeQQ	 
(QQ 
	statementQQ 
=>QQ 
	statementQQ '
.QQ' (
StatementTagsQQ( 5
)QQ5 6
.RR 	
ThenIncludeRR	 
(RR 
statementTagRR !
=>RR" $
statementTagRR% 1
.RR1 2
TagRR2 5
)RR5 6
;RR6 7
}SS 
ifTT 
(TT	 

tagsTT
 
isTT 
notTT 
nullTT 
&&TT 
tagsTT "
.TT" #
CountTT# (
>TT) *
$numTT+ ,
)TT, -
{UU 

statementsVV 
=VV 

statementsVV 
.VV  
WhereVV  %
(VV% &
	statementVV& /
=>VV0 2
	statementVV3 <
.VV< =
StatementTagsVV= J
.VVJ K
AnyVVK N
(VVN O
tagVVO R
=>VVS U
tagsVVV Z
.VVZ [
ContainsVV[ c
(VVc d
tagVVd g
.VVg h
TagIdVVh m
)VVm n
)VVn o
)VVo p
;VVp q
}WW 
varXX 	
sortedStatementsXX
 
=XX 

statementsXX '
.XX' (
OrderByDescendingXX( 9
(XX9 :
	statementXX: C
=>XXD F
	statementXXG P
.XXP Q
	CreatedAtXXQ Z
)XXZ [
;XX[ \
varYY 	
paginatedStatementsYY
 
=YY 
awaitYY  %
PaginatedListYY& 3
<YY3 4
	StatementYY4 =
>YY= >
.YY> ?
CreateAsyncYY? J
(YYJ K
sortedStatementsYYK [
,YY[ \

pageNumberYY] g
??YYh j
$numYYk l
,YYl m
pageSizeYYn v
??YYw y
$numYYz |
)YY| }
;YY} ~
returnZZ 
_mapperZZ 
.ZZ 
MapZZ 
<ZZ 
PaginatedListZZ &
<ZZ& '
	StatementZZ' 0
>ZZ0 1
,ZZ1 2
PaginatedListZZ3 @
<ZZ@ A
StatementOutDtoZZA P
>ZZP Q
>ZZQ R
(ZZR S
paginatedStatementsZZS f
)ZZf g
;ZZg h
}[[ 
public]] 

async]] 
Task]] 
<]] 
StatementOutDto]] %
>]]% &
GetStatementById]]' 7
(]]7 8
string]]8 >
id]]? A
)]]A B
{^^ 
var__ 	
	statement__
 
=__ 
await__ 
_context__ $
.__$ %

Statements__% /
.`` 	
Include``	 
(`` 
	statement`` 
=>`` 
	statement`` '
.``' (
	CreatedBy``( 1
)``1 2
.aa 	
Includeaa	 
(aa 
	statementaa 
=>aa 
	statementaa '
.aa' (

Politicianaa( 2
)aa2 3
.bb 	
Includebb	 
(bb 
	statementbb 
=>bb 
	statementbb '
.bb' (
StatementTagsbb( 5
)bb5 6
.cc 	
ThenIncludecc	 
(cc 
statementTagcc !
=>cc" $
statementTagcc% 1
.cc1 2
Tagcc2 5
)cc5 6
.dd 	 
SingleOrDefaultAsyncdd	 
(dd 
	statementdd '
=>dd( *
	statementdd+ 4
.dd4 5
StatementIddd5 @
==ddA C
idddD F
)ddF G
;ddG H
returnff 
_mapperff 
.ff 
Mapff 
<ff 
	Statementff "
,ff" #
StatementOutDtoff$ 3
>ff3 4
(ff4 5
	statementff5 >
)ff> ?
;ff? @
}gg 
publicii 

asyncii 
Taskii 
<ii 
	Statementii 
>ii  "
GetStatementEntityByIdii! 7
(ii7 8
stringii8 >
idii? A
)iiA B
{jj 
varkk 	
	statementkk
 
=kk 
awaitkk 
_contextkk $
.kk$ %

Statementskk% /
.ll 	
Includell	 
(ll 
	statementll 
=>ll 
	statementll '
.ll' (
	CreatedByll( 1
)ll1 2
.mm 	
Includemm	 
(mm 
	statementmm 
=>mm 
	statementmm '
.mm' (

Politicianmm( 2
)mm2 3
.nn 	
Includenn	 
(nn 
	statementnn 
=>nn 
	statementnn '
.nn' (
StatementTagsnn( 5
)nn5 6
.oo 	
ThenIncludeoo	 
(oo 
statementTagoo !
=>oo" $
statementTagoo% 1
.oo1 2
Tagoo2 5
)oo5 6
.pp 	 
SingleOrDefaultAsyncpp	 
(pp 
	statementpp '
=>pp( *
	statementpp+ 4
.pp4 5
StatementIdpp5 @
==ppA C
idppD F
)ppF G
;ppG H
returnrr 
	statementrr 
;rr 
}ss 
publicuu 

asyncuu 
Taskuu 
<uu 
StatementOutDtouu %
>uu% &
DeleteStatementByIduu' :
(uu: ;
stringuu; A
iduuB D
)uuD E
{vv 
varww 	
statementToDeleteww
 
=ww 
awaitww #
_contextww$ ,
.ww, -

Statementsww- 7
.ww7 8
	FindAsyncww8 A
(wwA B
idwwB D
)wwD E
;wwE F
ifxx 
(xx	 

statementToDeletexx
 
isxx 
nullxx #
)xx# $
{yy 
returnzz 
nullzz 
;zz 
}{{ 
var|| 	
statementTags||
 
=|| 
await|| 
_context||  (
.||( )
StatementTags||) 6
.||6 7
Where||7 <
(||< =
statementTag||= I
=>||J L
statementTag||M Y
.||Y Z
StatementId||Z e
==||f h
id||i k
)||k l
.||l m
ToListAsync||m x
(||x y
)||y z
;||z {
_context}} 
.}} 

Statements}} 
.}} 
Remove}}  
(}}  !
statementToDelete}}! 2
)}}2 3
;}}3 4
_context~~ 
.~~ 
StatementTags~~ 
.~~ 
RemoveRange~~ (
(~~( )
statementTags~~) 6
)~~6 7
;~~7 8
await 
_context 
. 
SaveChangesAsync %
(% &
)& '
;' (
return
ÄÄ 
_mapper
ÄÄ 
.
ÄÄ 
Map
ÄÄ 
<
ÄÄ 
	Statement
ÄÄ "
,
ÄÄ" #
StatementOutDto
ÄÄ$ 3
>
ÄÄ3 4
(
ÄÄ4 5
statementToDelete
ÄÄ5 F
)
ÄÄF G
;
ÄÄG H
}
ÅÅ 
public
ÉÉ 

async
ÉÉ 
Task
ÉÉ 
<
ÉÉ 
bool
ÉÉ 
>
ÉÉ 
LikeStatement
ÉÉ )
(
ÉÉ) *
string
ÉÉ* 0
statementId
ÉÉ1 <
,
ÉÉ< =
string
ÉÉ> D
userId
ÉÉE K
)
ÉÉK L
{
ÑÑ 
var
ÖÖ 	
like
ÖÖ
 
=
ÖÖ 
await
ÖÖ 
_context
ÖÖ 
.
ÖÖ  
Likes
ÖÖ  %
.
ÖÖ% &!
FirstOrDefaultAsync
ÖÖ& 9
(
ÖÖ9 :
like
ÖÖ: >
=>
ÖÖ? A
(
ÖÖB C
like
ÖÖC G
.
ÖÖG H
StatementId
ÖÖH S
==
ÖÖT V
statementId
ÖÖW b
&&
ÖÖc e
like
ÖÖf j
.
ÖÖj k
UserId
ÖÖk q
==
ÖÖr t
userId
ÖÖu {
)
ÖÖ{ |
)
ÖÖ| }
;
ÖÖ} ~
if
ÜÜ 
(
ÜÜ	 

like
ÜÜ
 
is
ÜÜ 
not
ÜÜ 
null
ÜÜ 
)
ÜÜ 
{
áá 
return
àà 
false
àà 
;
àà 
}
ââ 
await
ää 
_context
ää 
.
ää 
Likes
ää 
.
ää 
AddAsync
ää #
(
ää# $
new
ää$ '
Like
ää( ,
{
ãã 
LikeId
åå 
=
åå 
Guid
åå 
.
åå 
NewGuid
åå 
(
åå 
)
åå 
.
åå  
ToString
åå  (
(
åå( )
)
åå) *
,
åå* +
StatementId
çç 
=
çç 
statementId
çç !
,
çç! "
UserId
éé 
=
éé 
userId
éé 
}
èè 
)
èè 
;
èè 	
await
êê 
_context
êê 
.
êê 
SaveChangesAsync
êê %
(
êê% &
)
êê& '
;
êê' (
return
ëë 
true
ëë 
;
ëë 
}
íí 
public
îî 

async
îî 
Task
îî 
<
îî 
bool
îî 
>
îî 
UnlikeStatement
îî +
(
îî+ ,
string
îî, 2
statementId
îî3 >
,
îî> ?
string
îî@ F
userId
îîG M
)
îîM N
{
ïï 
var
ññ 	
like
ññ
 
=
ññ 
await
ññ 
_context
ññ 
.
ññ  
Likes
ññ  %
.
ññ% &!
FirstOrDefaultAsync
ññ& 9
(
ññ9 :
like
ññ: >
=>
ññ? A
(
ññB C
like
ññC G
.
ññG H
StatementId
ññH S
==
ññT V
statementId
ññW b
&&
ññc e
like
ññf j
.
ññj k
UserId
ññk q
==
ññr t
userId
ññu {
)
ññ{ |
)
ññ| }
;
ññ} ~
if
óó 
(
óó	 

like
óó
 
is
óó 
null
óó 
)
óó 
{
òò 
return
ôô 
false
ôô 
;
ôô 
}
öö 
_context
õõ 
.
õõ 
Likes
õõ 
.
õõ 
Remove
õõ 
(
õõ 
like
õõ  
)
õõ  !
;
õõ! "
await
úú 
_context
úú 
.
úú 
SaveChangesAsync
úú %
(
úú% &
)
úú& '
;
úú' (
return
ùù 
true
ùù 
;
ùù 
}
ûû 
public
†† 

int
†† 
GetLikeCount
†† 
(
†† 
string
†† "
statementId
††# .
)
††. /
{
°° 
return
¢¢ 
_context
¢¢ 
.
¢¢ 
Likes
¢¢ 
.
¢¢ 
Where
¢¢ !
(
¢¢! "
like
¢¢" &
=>
¢¢' )
like
¢¢* .
.
¢¢. /
StatementId
¢¢/ :
==
¢¢; =
statementId
¢¢> I
)
¢¢I J
.
¢¢J K
Count
¢¢K P
(
¢¢P Q
)
¢¢Q R
;
¢¢R S
}
££ 
public
•• 

async
•• 
Task
•• 
<
•• 
bool
•• 
>
•• !
CheckIfUserHasLiked
•• /
(
••/ 0
string
••0 6
statementId
••7 B
,
••B C
string
••D J
userId
••K Q
)
••Q R
{
¶¶ 
return
ßß 
await
ßß 
_context
ßß 
.
ßß 
Likes
ßß !
.
ßß! "
AnyAsync
ßß" *
(
ßß* +
like
ßß+ /
=>
ßß0 2
(
ßß3 4
like
ßß4 8
.
ßß8 9
StatementId
ßß9 D
==
ßßE G
statementId
ßßH S
&&
ßßT V
like
ßßW [
.
ßß[ \
UserId
ßß\ b
==
ßßc e
userId
ßßf l
)
ßßl m
)
ßßm n
;
ßßn o
}
®® 
}
©© 
}™™ Ô&
4D:\Programavimas\politik\back\Data\TagsRepository.cs
	namespace		 	
Politics		
 
.		 
Data		 
{

 
public 
class	 
TagsRepository 
: 
ITagsRepository  /
{ 
private 
readonly 
PoliticsDbContext &
_context' /
;/ 0
private 
readonly 
IMapper 
_mapper $
;$ %
public 

TagsRepository 
( 
PoliticsDbContext +
context, 3
,3 4
IMapper5 <
mapper= C
)C D
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
	TagOutDto 
>  
AddTag! '
(' (
TagDto( .
tagDto/ 5
,5 6
string7 =
userId> D
)D E
{ 
var 	
existingTag
 
= 
await 
_context &
.& '
Tags' +
.+ ,
FirstOrDefaultAsync, ?
(? @
tag@ C
=>D F
tagG J
.J K
NameK O
==P R
tagDtoS Y
.Y Z
NameZ ^
)^ _
;_ `
if 
(	 

existingTag
 
is 
not 
null !
)! "
{ 
return 
_mapper 
. 
Map 
< 
Tag 
, 
	TagOutDto  )
>) *
(* +
existingTag+ 6
)6 7
;7 8
} 
var 	
tag
 
= 
_mapper 
. 
Map 
< 
TagDto "
," #
Tag$ '
>' (
(( )
tagDto) /
)/ 0
;0 1
tag 	
.	 

TagId
 
= 
Guid 
. 
NewGuid 
( 
)  
.  !
ToString! )
() *
)* +
;+ ,
tag 	
.	 

	CreatedAt
 
= 
DateTime 
. 
Now "
;" #
tag   	
.  	 

CreatedById  
 
=   
userId   
;   
await!! 
_context!! 
.!! 
AddAsync!! 
(!! 
tag!! !
)!!! "
;!!" #
await"" 
_context"" 
."" 
SaveChangesAsync"" %
(""% &
)""& '
;""' (
return## 
_mapper## 
.## 
Map## 
<## 
Tag## 
,## 
	TagOutDto## '
>##' (
(##( )
tag##) ,
)##, -
;##- .
}$$ 
public&& 

async&& 
Task&& 
	DeleteTag&& 
(&&  
string&&  &
id&&' )
)&&) *
{'' 
var(( 	
tag((
 
=(( 
_context(( 
.(( 
Tags(( 
.(( 
Find(( "
(((" #
id((# %
)((% &
;((& '
_context)) 
.)) 
Tags)) 
.)) 
Remove)) 
()) 
tag)) 
))) 
;))  
await** 
_context** 
.** 
SaveChangesAsync** %
(**% &
)**& '
;**' (
}++ 
public-- 

async-- 
Task-- 
<-- 
List-- 
<-- 
	TagOutDto-- $
>--$ %
>--% &

GetAllTags--' 1
(--1 2
)--2 3
{.. 
var// 	
tags//
 
=// 
await// 
_context// 
.//  
Tags//  $
.//$ %
ToListAsync//% 0
(//0 1
)//1 2
;//2 3
return00 
_mapper00 
.00 
Map00 
<00 
List00 
<00 
Tag00 !
>00! "
,00" #
List00$ (
<00( )
	TagOutDto00) 2
>002 3
>003 4
(004 5
tags005 9
)009 :
;00: ;
}11 
public33 

async33 
Task33 
<33 
Tag33 
>33 
GetTagEntityById33 +
(33+ ,
string33, 2
id333 5
)335 6
{44 
return55 
await55 
_context55 
.55 
Tags55  
.55  !
	FindAsync55! *
(55* +
id55+ -
)55- .
;55. /
}66 
}77 
}88  
?D:\Programavimas\politik\back\Dtos\Auth\ChangeDisplayNameDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	  
ChangeDisplayNameDto #
{ 
public 

string 
UserId 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
NewDisplayName  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} ∏
9D:\Programavimas\politik\back\Dtos\Auth\ChangeEmailDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
ChangeEmailDto 
{ 
public 

string 
UserId 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
NewEmail 
{ 
get  
;  !
set" %
;% &
}' (
} 
} ‡
<D:\Programavimas\politik\back\Dtos\Auth\ChangePasswordDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
ChangePasswordDto  
{ 
public 

string 
UserId 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
OldPassword 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
NewPassword 
{ 
get  #
;# $
set% (
;( )
}* +
} 
}		 ´
3D:\Programavimas\politik\back\Dtos\Auth\LoginDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
LoginDto 
{ 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} 
} È
6D:\Programavimas\politik\back\Dtos\Auth\RegisterDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
RegisterDto 
{ 
[ 
Required 
] 
public 

string 
DisplayName 
{ 
get  #
;# $
set% (
;( )
}* +
[		 
Required		 
]		 
public

 

string

 
Email

 
{

 
get

 
;

 
set

 "
;

" #
}

$ %
[ 
Required 
] 
[ 
StringLength 
( 
$num 
, 
MinimumLength #
=$ %
$num& '
,' (
ErrorMessage) 5
=6 7
$str8 r
)r s
]s t
public 

string 
Password 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ï
9D:\Programavimas\politik\back\Dtos\Auth\UserProfileDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
UserProfileDto 
{ 
public 

string 
UserId 
{ 
get 
; 
set  #
;# $
}% &
public 

string 
DisplayName 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Role 
{ 
get 
; 
set !
;! "
}# $
}		 
}

 ∞
4D:\Programavimas\politik\back\Dtos\Party\PartyDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
PartyDto 
{ 
public 

string 
	ShortName 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
LongName 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ã
7D:\Programavimas\politik\back\Dtos\Party\PartyOutDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
PartyOutDto 
{ 
public 

string 
Id 
{ 
get 
; 
set 
;  
}! "
public 

string 
	ShortName 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
LongName 
{ 
get  
;  !
set" %
;% &
}' (
} 
}		 à
>D:\Programavimas\politik\back\Dtos\Politician\PoliticianDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
PoliticianDto 
{ 
public 

string 
? 
PartyId 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
	FirstName 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
LastName 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
}		 
}

 ¥	
AD:\Programavimas\politik\back\Dtos\Politician\PoliticianOutDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
PoliticianOutDto 
{ 
public 

string 
Id 
{ 
get 
; 
set 
;  
}! "
public 

PartyOutDto 
Party 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
	FirstName 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
LastName 
{ 
get  
;  !
set" %
;% &
}' (
public		 

string		 
FullName		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
public

 

string

 
Description

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
} 
} Ã
DD:\Programavimas\politik\back\Dtos\Politician\UpdatePoliticianDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
UpdatePoliticianDto "
{ 
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
PartyId 
{ 
get 
;  
set! $
;$ %
}& '
} 
} ∏
6D:\Programavimas\politik\back\Dtos\Report\ReportDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
	ReportDto 
{ 
public 

string 
StatementId 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ¡	
9D:\Programavimas\politik\back\Dtos\Report\ReportOutDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
ReportOutDto 
{ 
public 

string 
ReportId 
{ 
get  
;  !
set" %
;% &
}' (
public 

string 
StatementId 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
public 

bool 

IsReviewed 
{ 
get  
;  !
set" %
;% &
}' (
public		 

UserProfileDto		 
	CreatedBy		 #
{		$ %
get		& )
;		) *
set		+ .
;		. /
}		1 2
public

 

UserProfileDto

 

ReviewedBy

 $
{

% &
get

' *
;

* +
set

, /
;

/ 0
}

1 2
} 
} •
<D:\Programavimas\politik\back\Dtos\Statement\StatementDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
StatementDto 
{ 
public 

string 
PoliticianId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

string 
Link 
{ 
get 
; 
set !
;! "
}# $
public		 

string		 
Description		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
public

 

List

 
<

 
	TagOutDto

 
>

 
Tags

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
} 
} ˇ

?D:\Programavimas\politik\back\Dtos\Statement\StatementOutDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
StatementOutDto 
{ 
public 

string 
StatementId 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 

Politician 
{ 
get "
;" #
set$ '
;' (
}) *
public		 

string		 
Link		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
public

 

string

 
Description

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 

List 
< 
string 
> 
Tags 
{ 
get "
;" #
set$ '
;' (
}) *
public 

string 
	CreatedBy 
{ 
get !
;! "
set# &
;& '
}( )
public 

string 
	CreatedAt 
{ 
get !
;! "
set# &
;& '
}( )
} 
} â
0D:\Programavimas\politik\back\Dtos\Tag\TagDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
TagDto 
{ 
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
} 
} ®
3D:\Programavimas\politik\back\Dtos\Tag\TagOutDto.cs
	namespace 	
Politics
 
. 
Dtos 
{ 
public 
class	 
	TagOutDto 
{ 
public 

string 
TagId 
{ 
get 
; 
set "
;" #
}$ %
public 

string 
Name 
{ 
get 
; 
set !
;! "
}# $
} 
} ˜
6D:\Programavimas\politik\back\Helpers\PaginatedList.cs
	namespace 	
Politics
 
. 
Helpers 
{ 
public		 
class			 
PaginatedList		 
<		 
T		 
>		 
:		  !
List		" &
<		& '
T		' (
>		( )
{

 
public 

int 
	PageIndex 
{ 
get 
; 
private  '
set( +
;+ ,
}- .
public 

int 
PageSize 
{ 
get 
; 
private &
set' *
;* +
}, -
public 

int 

TotalPages 
{ 
get 
;  
private! (
set) ,
;, -
}. /
public 

int 

TotalCount 
{ 
get 
;  
private! (
set) ,
;, -
}. /
public 

PaginatedList 
( 
List 
< 
T 
>  
items! &
,& '
int( +
count, 1
,1 2
int3 6
	pageIndex7 @
,@ A
intB E
pageSizeF N
)N O
{ 
	PageIndex 
= 
	pageIndex 
; 
PageSize 
= 
pageSize 
; 

TotalPages 
= 
( 
int 
) 
Math 
. 
Ceiling $
($ %
count% *
/+ ,
(- .
double. 4
)4 5
pageSize6 >
)> ?
;? @

TotalCount 
= 
count 
; 
this 

.
 
AddRange 
( 
items 
) 
; 
} 
public 

bool 
HasPreviousPage 
{ 
get 	
{ 
return 
( 
	PageIndex 
> 
$num 
) 
; 
} 
}   
public"" 

bool"" 
HasNextPage"" 
{## 
get$$ 	
{%% 
return&& 
(&& 
	PageIndex&& 
<&& 

TotalPages&& &
)&&& '
;&&' (
}'' 
}(( 
public** 

static** 
async** 
Task** 
<** 
PaginatedList** *
<*** +
T**+ ,
>**, -
>**- .
CreateAsync**/ :
(**: ;

IQueryable**; E
<**E F
T**F G
>**G H
source**I O
,**O P
int**Q T
	pageIndex**U ^
,**^ _
int**` c
pageSize**d l
)**l m
{++ 
var,, 	
count,,
 
=,, 
await,, 
source,, 
.,, 

CountAsync,, )
(,,) *
),,* +
;,,+ ,
var-- 	
items--
 
=-- 
await-- 
source-- 
.-- 
Skip-- #
(--# $
(--$ %
	pageIndex--% .
---/ 0
$num--1 2
)--2 3
*--4 5
pageSize--6 >
)--> ?
.--? @
Take--@ D
(--D E
pageSize--E M
)--M N
.--N O
ToListAsync--O Z
(--Z [
)--[ \
;--\ ]
return.. 
new.. 
PaginatedList.. 
<.. 
T..  
>..  !
(..! "
items.." '
,..' (
count..) .
,... /
	pageIndex..0 9
,..9 :
pageSize..; C
)..C D
;..D E
}// 
}00 
}11 Ô
9D:\Programavimas\politik\back\Helpers\PaginationParams.cs
	namespace 	
Politics
 
. 
Helpers 
{ 
public 
abstract	 
class 
PaginationParams (
{ 
public 

int 
? 

PageNumber 
{ 
get  
;  !
set" %
;% &
}' (
public 

int 
? 
PageSize 
{ 
get 
; 
set  #
;# $
}% &
} 
} ÕA
7D:\Programavimas\politik\back\Mapping\MappingProfile.cs
	namespace 	
Politics
 
. 
Mapping 
{ 
public		 
class			 
MappingProfile		 
:		 
Profile		  '
{

 
public 

MappingProfile 
( 
) 
{ 
	CreateMap 
< 

Politician 
, 
PoliticianOutDto ,
>, -
(- .
). /
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  
Id  "
," #
opt$ '
=>( *
opt+ .
.. /
MapFrom/ 6
(6 7
src7 :
=>; =
src> A
.A B
PoliticianIdB N
)N O
)O P
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  
FullName  (
,( )
opt* -
=>. 0
opt1 4
.4 5
MapFrom5 <
(< =
src= @
=>A C
srcD G
.G H
	FirstNameH Q
+R S
$charT W
+X Y
srcZ ]
.] ^
LastName^ f
)f g
)g h
;h i
	CreateMap 
< 
PoliticianDto 
, 

Politician )
>) *
(* +
)+ ,
;, -
	CreateMap 
< 
Party 
, 
PartyOutDto "
>" #
(# $
)$ %
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  
Id  "
," #
opt$ '
=>( *
opt+ .
.. /
MapFrom/ 6
(6 7
src7 :
=>; =
src> A
.A B
PartyIdB I
)I J
)J K
;K L
	CreateMap 
< 
PartyDto 
, 
Party 
>  
(  !
)! "
;" #
	CreateMap 
< 
TagDto 
, 
Tag 
> 
( 
) 
; 
	CreateMap 
< 
Tag 
, 
	TagOutDto 
> 
(  
)  !
;! "
	CreateMap 
< 
	TagOutDto 
, 
TagDto !
>! "
(" #
)# $
;$ %
	CreateMap 
< 
StatementDto 
, 
	Statement '
>' (
(( )
)) *
.* +
	ForMember+ 4
(4 5
dest5 9
=>: <
dest= A
.A B
TagsB F
,F G
optH K
=>L N
optO R
.R S
IgnoreS Y
(Y Z
)Z [
)[ \
;\ ]
	CreateMap 
< 
Tag 
, 
string 
> 
( 
) 
. 
ConvertUsing +
(+ ,
src, /
=>0 2
src3 6
.6 7
Name7 ;
); <
;< =
	CreateMap 
< 
	Statement 
, 
StatementOutDto *
>* +
(+ ,
), -
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  
	CreatedBy  )
,) *
opt+ .
=>/ 1
opt2 5
.5 6
MapFrom6 =
(= >
src> A
=>B D
srcE H
.H I
	CreatedByI R
.R S
DisplayNameS ^
)^ _
)_ `
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  

Politician  *
,* +
opt, /
=>0 2
opt3 6
.6 7
MapFrom7 >
(> ?
src? B
=>C E
srcF I
.I J

PoliticianJ T
.T U
	FirstNameU ^
+_ `
$chara d
+e f
srcg j
.j k

Politiciank u
.u v
LastNamev ~
)~ 
)	 Ä
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  
Tags  $
,$ %
opt& )
=>* ,
opt- 0
.0 1
MapFrom1 8
(8 9
src9 <
=>= ?
src@ C
.C D
TagsD H
)H I
)I J
;J K
	CreateMap 
( 
typeof 
( 
PaginatedList $
<$ %
>% &
)& '
,' (
typeof) /
(/ 0
PaginatedList0 =
<= >
>> ?
)? @
)@ A
.A B
ConvertUsingB N
(N O
typeofO U
(U V
	ConverterV _
<_ `
,` a
>a b
)b c
)c d
;d e
	CreateMap 
< 
User 
, 
UserProfileDto $
>$ %
(% &
)& '
. 	
	ForMember	 
( 
dest 
=> 
dest 
.  
Role  $
,$ %
opt& )
=>* ,
opt- 0
.0 1
MapFrom1 8
(8 9
src9 <
=>= ?
src@ C
.C D
RoleD H
.H I
NameI M
)M N
)N O
;O P
	CreateMap   
<   
LoginDto   
,   
User   
>   
(    
)    !
;  ! "
	CreateMap!! 
<!! 
RegisterDto!! 
,!! 
User!! !
>!!! "
(!!" #
)!!# $
;!!$ %
	CreateMap"" 
<"" 
	ReportDto"" 
,"" 
Report"" !
>""! "
(""" #
)""# $
;""$ %
	CreateMap## 
<## 
Report## 
,## 
ReportOutDto## $
>##$ %
(##% &
)##& '
;##' (
	CreateMap$$ 
<$$ 
ReportOutDto$$ 
,$$ 
Report$$ $
>$$$ %
($$% &
)$$& '
;$$' (
}%% 
private&& 
class&& 
	Converter&& 
<&& 
TSource&& #
,&&# $
TDestination&&% 1
>&&1 2
:'' 
ITypeConverter'' 
<'' 
PaginatedList'' "
<''" #
TSource''# *
>''* +
,''+ ,
PaginatedList''- :
<'': ;
TDestination''; G
>''G H
>''H I
{(( 
public)) 
PaginatedList)) 
<)) 
TDestination)) '
>))' (
Convert))) 0
())0 1
PaginatedList**
 
<** 
TSource** 
>**  
source**! '
,**' (
PaginatedList++
 
<++ 
TDestination++ $
>++$ %
destination++& 1
,++1 2
ResolutionContext,,
 
context,, #
),,# $
=>,,% '
new--
 
PaginatedList-- 
<-- 
TDestination-- (
>--( )
(--) *
context.. 
... 
Mapper.. 
... 
Map..  
<..  !
List..! %
<..% &
TSource..& -
>..- .
,... /
List..0 4
<..4 5
TDestination..5 A
>..A B
>..B C
(..C D
source..D J
)..J K
,..K L
source..M S
...S T

TotalCount..T ^
,..^ _
source..` f
...f g
	PageIndex..g p
,..p q
source..r x
...x y
PageSize	..y Å
)
..Å Ç
;
..Ç É
}// 
}00 
}11 ”e
HD:\Programavimas\politik\back\Migrations\20211013182223_InitialCreate.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Partyid 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= Z
,Z [
nullable\ d
:d e
falsef k
)k l
,l m
	UpdatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= Z
,Z [
nullable\ d
:d e
falsef k
)k l
,l m
	CreatedBy 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; A
,A B
nullableC K
:K L
falseM R
)R S
,S T
	UpdatedBy 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; A
,A B
nullableC K
:K L
trueM Q
)Q R
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Partyid: A
)A B
;B C
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
RoleId 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
}   
,   
constraints!! 
:!! 
table!! "
=>!!# %
{"" 
table## 
.## 

PrimaryKey## $
(##$ %
$str##% /
,##/ 0
x##1 2
=>##3 5
x##6 7
.##7 8
RoleId##8 >
)##> ?
;##? @
}$$ 
)$$ 
;$$ 
migrationBuilder&& 
.&& 
CreateTable&& (
(&&( )
name'' 
:'' 
$str'' #
,''# $
columns(( 
:(( 
table(( 
=>(( !
new((" %
{)) 
PoliticianId**  
=**! "
table**# (
.**( )
Column**) /
<**/ 0
string**0 6
>**6 7
(**7 8
type**8 <
:**< =
$str**> D
,**D E
nullable**F N
:**N O
false**P U
)**U V
,**V W
PartyId++ 
=++ 
table++ #
.++# $
Column++$ *
<++* +
string+++ 1
>++1 2
(++2 3
type++3 7
:++7 8
$str++9 ?
,++? @
nullable++A I
:++I J
true++K O
)++O P
,++P Q
FullName,, 
=,, 
table,, $
.,,$ %
Column,,% +
<,,+ ,
string,,, 2
>,,2 3
(,,3 4
type,,4 8
:,,8 9
$str,,: @
,,,@ A
nullable,,B J
:,,J K
false,,L Q
),,Q R
,,,R S
Description-- 
=--  !
table--" '
.--' (
Column--( .
<--. /
string--/ 5
>--5 6
(--6 7
type--7 ;
:--; <
$str--= C
,--C D
nullable--E M
:--M N
true--O S
)--S T
,--T U
	CreatedAt.. 
=.. 
table..  %
...% &
Column..& ,
<.., -
DateTime..- 5
>..5 6
(..6 7
type..7 ;
:..; <
$str..= Z
,..Z [
nullable..\ d
:..d e
false..f k
)..k l
,..l m
	UpdatedAt// 
=// 
table//  %
.//% &
Column//& ,
<//, -
DateTime//- 5
>//5 6
(//6 7
type//7 ;
://; <
$str//= Z
,//Z [
nullable//\ d
://d e
false//f k
)//k l
,//l m
	CreatedBy00 
=00 
table00  %
.00% &
Column00& ,
<00, -
string00- 3
>003 4
(004 5
type005 9
:009 :
$str00; A
,00A B
nullable00C K
:00K L
false00M R
)00R S
,00S T
	UpdatedBy11 
=11 
table11  %
.11% &
Column11& ,
<11, -
string11- 3
>113 4
(114 5
type115 9
:119 :
$str11; A
,11A B
nullable11C K
:11K L
true11M Q
)11Q R
}22 
,22 
constraints33 
:33 
table33 "
=>33# %
{44 
table55 
.55 

PrimaryKey55 $
(55$ %
$str55% 5
,555 6
x557 8
=>559 ;
x55< =
.55= >
PoliticianId55> J
)55J K
;55K L
table66 
.66 

ForeignKey66 $
(66$ %
name77 
:77 
$str77 >
,77> ?
column88 
:88 
x88  !
=>88" $
x88% &
.88& '
PartyId88' .
,88. /
principalTable99 &
:99& '
$str99( 1
,991 2
principalColumn:: '
:::' (
$str::) 2
,::2 3
onDelete;;  
:;;  !
ReferentialAction;;" 3
.;;3 4
Restrict;;4 <
);;< =
;;;= >
}<< 
)<< 
;<< 
migrationBuilder>> 
.>> 
CreateTable>> (
(>>( )
name?? 
:?? 
$str?? 
,?? 
columns@@ 
:@@ 
table@@ 
=>@@ !
new@@" %
{AA 
UserIdBB 
=BB 
tableBB "
.BB" #
ColumnBB# )
<BB) *
stringBB* 0
>BB0 1
(BB1 2
typeBB2 6
:BB6 7
$strBB8 >
,BB> ?
nullableBB@ H
:BBH I
falseBBJ O
)BBO P
,BBP Q
EmailCC 
=CC 
tableCC !
.CC! "
ColumnCC" (
<CC( )
stringCC) /
>CC/ 0
(CC0 1
typeCC1 5
:CC5 6
$strCC7 =
,CC= >
nullableCC? G
:CCG H
falseCCI N
)CCN O
,CCO P
DisplayNameDD 
=DD  !
tableDD" '
.DD' (
ColumnDD( .
<DD. /
stringDD/ 5
>DD5 6
(DD6 7
typeDD7 ;
:DD; <
$strDD= C
,DDC D
nullableDDE M
:DDM N
falseDDO T
)DDT U
,DDU V
PasswordHashEE  
=EE! "
tableEE# (
.EE( )
ColumnEE) /
<EE/ 0
stringEE0 6
>EE6 7
(EE7 8
typeEE8 <
:EE< =
$strEE> D
,EED E
nullableEEF N
:EEN O
falseEEP U
)EEU V
,EEV W
PasswordSaltFF  
=FF! "
tableFF# (
.FF( )
ColumnFF) /
<FF/ 0
stringFF0 6
>FF6 7
(FF7 8
typeFF8 <
:FF< =
$strFF> D
,FFD E
nullableFFF N
:FFN O
falseFFP U
)FFU V
,FFV W
RoleIdGG 
=GG 
tableGG "
.GG" #
ColumnGG# )
<GG) *
stringGG* 0
>GG0 1
(GG1 2
typeGG2 6
:GG6 7
$strGG8 >
,GG> ?
nullableGG@ H
:GGH I
falseGGJ O
)GGO P
,GGP Q
	CreatedAtHH 
=HH 
tableHH  %
.HH% &
ColumnHH& ,
<HH, -
DateTimeHH- 5
>HH5 6
(HH6 7
typeHH7 ;
:HH; <
$strHH= Z
,HHZ [
nullableHH\ d
:HHd e
falseHHf k
)HHk l
,HHl m
	UpdatedAtII 
=II 
tableII  %
.II% &
ColumnII& ,
<II, -
DateTimeII- 5
>II5 6
(II6 7
typeII7 ;
:II; <
$strII= Z
,IIZ [
nullableII\ d
:IId e
falseIIf k
)IIk l
}JJ 
,JJ 
constraintsKK 
:KK 
tableKK "
=>KK# %
{LL 
tableMM 
.MM 

PrimaryKeyMM $
(MM$ %
$strMM% /
,MM/ 0
xMM1 2
=>MM3 5
xMM6 7
.MM7 8
UserIdMM8 >
)MM> ?
;MM? @
tableNN 
.NN 

ForeignKeyNN $
(NN$ %
nameOO 
:OO 
$strOO 5
,OO5 6
columnPP 
:PP 
xPP  !
=>PP" $
xPP% &
.PP& '
RoleIdPP' -
,PP- .
principalTableQQ &
:QQ& '
$strQQ( /
,QQ/ 0
principalColumnRR '
:RR' (
$strRR) 1
,RR1 2
onDeleteSS  
:SS  !
ReferentialActionSS" 3
.SS3 4
CascadeSS4 ;
)SS; <
;SS< =
}TT 
)TT 
;TT 
migrationBuilderVV 
.VV 
CreateIndexVV (
(VV( )
nameWW 
:WW 
$strWW .
,WW. /
tableXX 
:XX 
$strXX $
,XX$ %
columnYY 
:YY 
$strYY !
)YY! "
;YY" #
migrationBuilder[[ 
.[[ 
CreateIndex[[ (
([[( )
name\\ 
:\\ 
$str\\ '
,\\' (
table]] 
:]] 
$str]] 
,]] 
column^^ 
:^^ 
$str^^  
)^^  !
;^^! "
}__ 	
	protectedaa 
overrideaa 
voidaa 
Downaa  $
(aa$ %
MigrationBuilderaa% 5
migrationBuilderaa6 F
)aaF G
{bb 	
migrationBuildercc 
.cc 
	DropTablecc &
(cc& '
namedd 
:dd 
$strdd #
)dd# $
;dd$ %
migrationBuilderff 
.ff 
	DropTableff &
(ff& '
namegg 
:gg 
$strgg 
)gg 
;gg 
migrationBuilderii 
.ii 
	DropTableii &
(ii& '
namejj 
:jj 
$strjj 
)jj  
;jj  !
migrationBuilderll 
.ll 
	DropTablell &
(ll& '
namemm 
:mm 
$strmm 
)mm 
;mm 
}nn 	
}oo 
}pp °*
YD:\Programavimas\politik\back\Migrations\20211023152735_UpdatePoliticianAndPartyTables.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class *
UpdatePoliticianAndPartyTables 7
:8 9
	Migration: C
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
RenameColumn		 )
(		) *
name

 
:

 
$str

  
,

  !
table 
: 
$str $
,$ %
newName 
: 
$str #
)# $
;$ %
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str 
,  
table 
: 
$str  
,  !
newName 
: 
$str "
)" #
;# $
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str 
, 
table 
: 
$str  
,  !
newName 
: 
$str $
)$ %
;% &
migrationBuilder 
. 
AlterColumn (
<( )
string) /
>/ 0
(0 1
name 
: 
$str #
,# $
table 
: 
$str $
,$ %
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
$str  
,  !

oldClrType 
: 
typeof "
(" #
string# )
)) *
,* +
oldType 
: 
$str 
,  
oldNullable   
:   
true   !
)  ! "
;  " #
migrationBuilder"" 
."" 
	AddColumn"" &
<""& '
string""' -
>""- .
("". /
name## 
:## 
$str## !
,##! "
table$$ 
:$$ 
$str$$ $
,$$$ %
type%% 
:%% 
$str%% 
,%% 
nullable&& 
:&& 
false&& 
,&&  
defaultValue'' 
:'' 
$str''  
)''  !
;''! "
migrationBuilder)) 
.)) 
	AddColumn)) &
<))& '
string))' -
>))- .
()). /
name** 
:** 
$str**  
,**  !
table++ 
:++ 
$str++  
,++  !
type,, 
:,, 
$str,, 
,,, 
nullable-- 
:-- 
false-- 
,--  
defaultValue.. 
:.. 
$str..  
)..  !
;..! "
}// 	
	protected11 
override11 
void11 
Down11  $
(11$ %
MigrationBuilder11% 5
migrationBuilder116 F
)11F G
{22 	
migrationBuilder33 
.33 

DropColumn33 '
(33' (
name44 
:44 
$str44 !
,44! "
table55 
:55 
$str55 $
)55$ %
;55% &
migrationBuilder77 
.77 

DropColumn77 '
(77' (
name88 
:88 
$str88  
,88  !
table99 
:99 
$str99  
)99  !
;99! "
migrationBuilder;; 
.;; 
RenameColumn;; )
(;;) *
name<< 
:<< 
$str<<  
,<<  !
table== 
:== 
$str== $
,==$ %
newName>> 
:>> 
$str>> #
)>># $
;>>$ %
migrationBuilder@@ 
.@@ 
RenameColumn@@ )
(@@) *
nameAA 
:AA 
$strAA 
,AA  
tableBB 
:BB 
$strBB  
,BB  !
newNameCC 
:CC 
$strCC "
)CC" #
;CC# $
migrationBuilderEE 
.EE 
RenameColumnEE )
(EE) *
nameFF 
:FF 
$strFF !
,FF! "
tableGG 
:GG 
$strGG  
,GG  !
newNameHH 
:HH 
$strHH 
)HH  
;HH  !
migrationBuilderJJ 
.JJ 
AlterColumnJJ (
<JJ( )
stringJJ) /
>JJ/ 0
(JJ0 1
nameKK 
:KK 
$strKK #
,KK# $
tableLL 
:LL 
$strLL $
,LL$ %
typeMM 
:MM 
$strMM 
,MM 
nullableNN 
:NN 
trueNN 
,NN 

oldClrTypeOO 
:OO 
typeofOO "
(OO" #
stringOO# )
)OO) *
,OO* +
oldTypePP 
:PP 
$strPP 
)PP  
;PP  !
}QQ 	
}RR 
}SS πC
\D:\Programavimas\politik\back\Migrations\20211024074011_UpdateCreatedAndUpdatedProperties.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class -
!UpdateCreatedAndUpdatedProperties :
:; <
	Migration= F
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
RenameColumn		 )
(		) *
name

 
:

 
$str

 !
,

! "
table 
: 
$str $
,$ %
newName 
: 
$str &
)& '
;' (
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str !
,! "
table 
: 
$str $
,$ %
newName 
: 
$str &
)& '
;' (
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str !
,! "
table 
: 
$str  
,  !
newName 
: 
$str &
)& '
;' (
migrationBuilder 
. 
RenameColumn )
() *
name 
: 
$str !
,! "
table 
: 
$str  
,  !
newName 
: 
$str &
)& '
;' (
migrationBuilder 
. 
CreateIndex (
(( )
name 
: 
$str 2
,2 3
table 
: 
$str $
,$ %
column   
:   
$str   %
)  % &
;  & '
migrationBuilder"" 
."" 
CreateIndex"" (
(""( )
name## 
:## 
$str## 2
,##2 3
table$$ 
:$$ 
$str$$ $
,$$$ %
column%% 
:%% 
$str%% %
)%%% &
;%%& '
migrationBuilder'' 
.'' 
CreateIndex'' (
(''( )
name(( 
:(( 
$str(( .
,((. /
table)) 
:)) 
$str))  
,))  !
column** 
:** 
$str** %
)**% &
;**& '
migrationBuilder,, 
.,, 
CreateIndex,, (
(,,( )
name-- 
:-- 
$str-- .
,--. /
table.. 
:.. 
$str..  
,..  !
column// 
:// 
$str// %
)//% &
;//& '
migrationBuilder11 
.11 
AddForeignKey11 *
(11* +
name22 
:22 
$str22 4
,224 5
table33 
:33 
$str33  
,33  !
column44 
:44 
$str44 %
,44% &
principalTable55 
:55 
$str55  '
,55' (
principalColumn66 
:66  
$str66! )
,66) *
onDelete77 
:77 
ReferentialAction77 +
.77+ ,
Cascade77, 3
)773 4
;774 5
migrationBuilder99 
.99 
AddForeignKey99 *
(99* +
name:: 
::: 
$str:: 4
,::4 5
table;; 
:;; 
$str;;  
,;;  !
column<< 
:<< 
$str<< %
,<<% &
principalTable== 
:== 
$str==  '
,==' (
principalColumn>> 
:>>  
$str>>! )
,>>) *
onDelete?? 
:?? 
ReferentialAction?? +
.??+ ,
Restrict??, 4
)??4 5
;??5 6
migrationBuilderAA 
.AA 
AddForeignKeyAA *
(AA* +
nameBB 
:BB 
$strBB 8
,BB8 9
tableCC 
:CC 
$strCC $
,CC$ %
columnDD 
:DD 
$strDD %
,DD% &
principalTableEE 
:EE 
$strEE  '
,EE' (
principalColumnFF 
:FF  
$strFF! )
,FF) *
onDeleteGG 
:GG 
ReferentialActionGG +
.GG+ ,
CascadeGG, 3
)GG3 4
;GG4 5
migrationBuilderII 
.II 
AddForeignKeyII *
(II* +
nameJJ 
:JJ 
$strJJ 8
,JJ8 9
tableKK 
:KK 
$strKK $
,KK$ %
columnLL 
:LL 
$strLL %
,LL% &
principalTableMM 
:MM 
$strMM  '
,MM' (
principalColumnNN 
:NN  
$strNN! )
,NN) *
onDeleteOO 
:OO 
ReferentialActionOO +
.OO+ ,
RestrictOO, 4
)OO4 5
;OO5 6
}PP 	
	protectedRR 
overrideRR 
voidRR 
DownRR  $
(RR$ %
MigrationBuilderRR% 5
migrationBuilderRR6 F
)RRF G
{SS 	
migrationBuilderTT 
.TT 
DropForeignKeyTT +
(TT+ ,
nameUU 
:UU 
$strUU 4
,UU4 5
tableVV 
:VV 
$strVV  
)VV  !
;VV! "
migrationBuilderXX 
.XX 
DropForeignKeyXX +
(XX+ ,
nameYY 
:YY 
$strYY 4
,YY4 5
tableZZ 
:ZZ 
$strZZ  
)ZZ  !
;ZZ! "
migrationBuilder\\ 
.\\ 
DropForeignKey\\ +
(\\+ ,
name]] 
:]] 
$str]] 8
,]]8 9
table^^ 
:^^ 
$str^^ $
)^^$ %
;^^% &
migrationBuilder`` 
.`` 
DropForeignKey`` +
(``+ ,
nameaa 
:aa 
$straa 8
,aa8 9
tablebb 
:bb 
$strbb $
)bb$ %
;bb% &
migrationBuilderdd 
.dd 
	DropIndexdd &
(dd& '
nameee 
:ee 
$stree 2
,ee2 3
tableff 
:ff 
$strff $
)ff$ %
;ff% &
migrationBuilderhh 
.hh 
	DropIndexhh &
(hh& '
nameii 
:ii 
$strii 2
,ii2 3
tablejj 
:jj 
$strjj $
)jj$ %
;jj% &
migrationBuilderll 
.ll 
	DropIndexll &
(ll& '
namemm 
:mm 
$strmm .
,mm. /
tablenn 
:nn 
$strnn  
)nn  !
;nn! "
migrationBuilderpp 
.pp 
	DropIndexpp &
(pp& '
nameqq 
:qq 
$strqq .
,qq. /
tablerr 
:rr 
$strrr  
)rr  !
;rr! "
migrationBuildertt 
.tt 
RenameColumntt )
(tt) *
nameuu 
:uu 
$struu #
,uu# $
tablevv 
:vv 
$strvv $
,vv$ %
newNameww 
:ww 
$strww $
)ww$ %
;ww% &
migrationBuilderyy 
.yy 
RenameColumnyy )
(yy) *
namezz 
:zz 
$strzz #
,zz# $
table{{ 
:{{ 
$str{{ $
,{{$ %
newName|| 
:|| 
$str|| $
)||$ %
;||% &
migrationBuilder~~ 
.~~ 
RenameColumn~~ )
(~~) *
name 
: 
$str #
,# $
table
ÄÄ 
:
ÄÄ 
$str
ÄÄ  
,
ÄÄ  !
newName
ÅÅ 
:
ÅÅ 
$str
ÅÅ $
)
ÅÅ$ %
;
ÅÅ% &
migrationBuilder
ÉÉ 
.
ÉÉ 
RenameColumn
ÉÉ )
(
ÉÉ) *
name
ÑÑ 
:
ÑÑ 
$str
ÑÑ #
,
ÑÑ# $
table
ÖÖ 
:
ÖÖ 
$str
ÖÖ  
,
ÖÖ  !
newName
ÜÜ 
:
ÜÜ 
$str
ÜÜ $
)
ÜÜ$ %
;
ÜÜ% &
}
áá 	
}
àà 
}ââ ße
OD:\Programavimas\politik\back\Migrations\20211024075732_AddStatementsAndTags.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class  
AddStatementsAndTags -
:. /
	Migration0 9
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str "
," #
columns 
: 
table 
=> !
new" %
{ 
StatementId 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V
PoliticianId  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> D
,D E
nullableF N
:N O
falseP U
)U V
,V W
Link 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V
CreatedById 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V
UpdatedById 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
trueO S
)S T
,T U
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= Z
,Z [
nullable\ d
:d e
falsef k
)k l
,l m
	UpdatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= Z
,Z [
nullable\ d
:d e
falsef k
)k l
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 4
,4 5
x6 7
=>8 :
x; <
.< =
StatementId= H
)H I
;I J
table 
. 

ForeignKey $
($ %
name 
: 
$str F
,F G
column 
: 
x  !
=>" $
x% &
.& '
PoliticianId' 3
,3 4
principalTable &
:& '
$str( 5
,5 6
principalColumn '
:' (
$str) 7
,7 8
onDelete  
:  !
ReferentialAction" 3
.3 4
Cascade4 ;
); <
;< =
table   
.   

ForeignKey   $
(  $ %
name!! 
:!! 
$str!! ?
,!!? @
column"" 
:"" 
x""  !
=>""" $
x""% &
.""& '
CreatedById""' 2
,""2 3
principalTable## &
:##& '
$str##( /
,##/ 0
principalColumn$$ '
:$$' (
$str$$) 1
,$$1 2
onDelete%%  
:%%  !
ReferentialAction%%" 3
.%%3 4
Cascade%%4 ;
)%%; <
;%%< =
table&& 
.&& 

ForeignKey&& $
(&&$ %
name'' 
:'' 
$str'' ?
,''? @
column(( 
:(( 
x((  !
=>((" $
x((% &
.((& '
UpdatedById((' 2
,((2 3
principalTable)) &
:))& '
$str))( /
,))/ 0
principalColumn** '
:**' (
$str**) 1
,**1 2
onDelete++  
:++  !
ReferentialAction++" 3
.++3 4
Restrict++4 <
)++< =
;++= >
},, 
),, 
;,, 
migrationBuilder.. 
... 
CreateTable.. (
(..( )
name// 
:// 
$str// 
,// 
columns00 
:00 
table00 
=>00 !
new00" %
{11 
TagId22 
=22 
table22 !
.22! "
Column22" (
<22( )
string22) /
>22/ 0
(220 1
type221 5
:225 6
$str227 =
,22= >
nullable22? G
:22G H
false22I N
)22N O
,22O P
Name33 
=33 
table33  
.33  !
Column33! '
<33' (
string33( .
>33. /
(33/ 0
type330 4
:334 5
$str336 <
,33< =
nullable33> F
:33F G
true33H L
)33L M
,33M N
	CreatedAt44 
=44 
table44  %
.44% &
Column44& ,
<44, -
DateTime44- 5
>445 6
(446 7
type447 ;
:44; <
$str44= Z
,44Z [
nullable44\ d
:44d e
false44f k
)44k l
,44l m
CreatedById55 
=55  !
table55" '
.55' (
Column55( .
<55. /
string55/ 5
>555 6
(556 7
type557 ;
:55; <
$str55= C
,55C D
nullable55E M
:55M N
true55O S
)55S T
}66 
,66 
constraints77 
:77 
table77 "
=>77# %
{88 
table99 
.99 

PrimaryKey99 $
(99$ %
$str99% .
,99. /
x990 1
=>992 4
x995 6
.996 7
TagId997 <
)99< =
;99= >
table:: 
.:: 

ForeignKey:: $
(::$ %
name;; 
:;; 
$str;; 9
,;;9 :
column<< 
:<< 
x<<  !
=><<" $
x<<% &
.<<& '
CreatedById<<' 2
,<<2 3
principalTable== &
:==& '
$str==( /
,==/ 0
principalColumn>> '
:>>' (
$str>>) 1
,>>1 2
onDelete??  
:??  !
ReferentialAction??" 3
.??3 4
Restrict??4 <
)??< =
;??= >
}@@ 
)@@ 
;@@ 
migrationBuilderBB 
.BB 
CreateTableBB (
(BB( )
nameCC 
:CC 
$strCC %
,CC% &
columnsDD 
:DD 
tableDD 
=>DD !
newDD" %
{EE 
StatementTagIdFF "
=FF# $
tableFF% *
.FF* +
ColumnFF+ 1
<FF1 2
stringFF2 8
>FF8 9
(FF9 :
typeFF: >
:FF> ?
$strFF@ F
,FFF G
nullableFFH P
:FFP Q
falseFFR W
)FFW X
,FFX Y
StatementIdGG 
=GG  !
tableGG" '
.GG' (
ColumnGG( .
<GG. /
stringGG/ 5
>GG5 6
(GG6 7
typeGG7 ;
:GG; <
$strGG= C
,GGC D
nullableGGE M
:GGM N
trueGGO S
)GGS T
,GGT U
TagIdHH 
=HH 
tableHH !
.HH! "
ColumnHH" (
<HH( )
stringHH) /
>HH/ 0
(HH0 1
typeHH1 5
:HH5 6
$strHH7 =
,HH= >
nullableHH? G
:HHG H
trueHHI M
)HHM N
}II 
,II 
constraintsJJ 
:JJ 
tableJJ "
=>JJ# %
{KK 
tableLL 
.LL 

PrimaryKeyLL $
(LL$ %
$strLL% 7
,LL7 8
xLL9 :
=>LL; =
xLL> ?
.LL? @
StatementTagIdLL@ N
)LLN O
;LLO P
tableMM 
.MM 

ForeignKeyMM $
(MM$ %
nameNN 
:NN 
$strNN G
,NNG H
columnOO 
:OO 
xOO  !
=>OO" $
xOO% &
.OO& '
StatementIdOO' 2
,OO2 3
principalTablePP &
:PP& '
$strPP( 4
,PP4 5
principalColumnQQ '
:QQ' (
$strQQ) 6
,QQ6 7
onDeleteRR  
:RR  !
ReferentialActionRR" 3
.RR3 4
RestrictRR4 <
)RR< =
;RR= >
tableSS 
.SS 

ForeignKeySS $
(SS$ %
nameTT 
:TT 
$strTT ;
,TT; <
columnUU 
:UU 
xUU  !
=>UU" $
xUU% &
.UU& '
TagIdUU' ,
,UU, -
principalTableVV &
:VV& '
$strVV( .
,VV. /
principalColumnWW '
:WW' (
$strWW) 0
,WW0 1
onDeleteXX  
:XX  !
ReferentialActionXX" 3
.XX3 4
RestrictXX4 <
)XX< =
;XX= >
}YY 
)YY 
;YY 
migrationBuilder[[ 
.[[ 
CreateIndex[[ (
([[( )
name\\ 
:\\ 
$str\\ 1
,\\1 2
table]] 
:]] 
$str]] #
,]]# $
column^^ 
:^^ 
$str^^ %
)^^% &
;^^& '
migrationBuilder`` 
.`` 
CreateIndex`` (
(``( )
nameaa 
:aa 
$straa 2
,aa2 3
tablebb 
:bb 
$strbb #
,bb# $
columncc 
:cc 
$strcc &
)cc& '
;cc' (
migrationBuilderee 
.ee 
CreateIndexee (
(ee( )
nameff 
:ff 
$strff 1
,ff1 2
tablegg 
:gg 
$strgg #
,gg# $
columnhh 
:hh 
$strhh %
)hh% &
;hh& '
migrationBuilderjj 
.jj 
CreateIndexjj (
(jj( )
namekk 
:kk 
$strkk 4
,kk4 5
tablell 
:ll 
$strll &
,ll& '
columnmm 
:mm 
$strmm %
)mm% &
;mm& '
migrationBuilderoo 
.oo 
CreateIndexoo (
(oo( )
namepp 
:pp 
$strpp .
,pp. /
tableqq 
:qq 
$strqq &
,qq& '
columnrr 
:rr 
$strrr 
)rr  
;rr  !
migrationBuildertt 
.tt 
CreateIndextt (
(tt( )
nameuu 
:uu 
$struu +
,uu+ ,
tablevv 
:vv 
$strvv 
,vv 
columnww 
:ww 
$strww %
)ww% &
;ww& '
}xx 	
	protectedzz 
overridezz 
voidzz 
Downzz  $
(zz$ %
MigrationBuilderzz% 5
migrationBuilderzz6 F
)zzF G
{{{ 	
migrationBuilder|| 
.|| 
	DropTable|| &
(||& '
name}} 
:}} 
$str}} %
)}}% &
;}}& '
migrationBuilder 
. 
	DropTable &
(& '
name
ÄÄ 
:
ÄÄ 
$str
ÄÄ "
)
ÄÄ" #
;
ÄÄ# $
migrationBuilder
ÇÇ 
.
ÇÇ 
	DropTable
ÇÇ &
(
ÇÇ& '
name
ÉÉ 
:
ÉÉ 
$str
ÉÉ 
)
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
}
ÖÖ 
}ÜÜ ¬1
JD:\Programavimas\politik\back\Migrations\20211114131015_UpdateUserTable.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class 
UpdateUserTable (
:) *
	Migration+ 4
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 

DropColumn

 '
(

' (
name 
: 
$str *
,* +
table 
: 
$str $
)$ %
;% &
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str *
,* +
table 
: 
$str $
)$ %
;% &
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
]' (
{) *
$num* +
,+ ,
$num- .
,. /
$num0 1
,1 2
$num3 4
}4 5
)5 6
;6 7
migrationBuilder 
. 
	AddColumn &
<& '
byte' +
[+ ,
], -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str 
, 
type 
: 
$str 
, 
nullable 
: 
false 
,  
defaultValue 
: 
new !
byte" &
[& '
]' (
{) *
$num+ ,
,, -
$num. /
,/ 0
$num1 2
,2 3
$num4 5
}6 7
)7 8
;8 9
migrationBuilder 
. 
	AddColumn &
<& '
bool' +
>+ ,
(, -
name 
: 
$str !
,! "
table   
:   
$str   
,   
type!! 
:!! 
$str!! 
,!!  
nullable"" 
:"" 
false"" 
,""  
defaultValue## 
:## 
false## #
)### $
;##$ %
migrationBuilder%% 
.%% 
CreateTable%% (
(%%( )
name&& 
:&& 
$str&& (
,&&( )
columns'' 
:'' 
table'' 
=>'' !
new''" %
{(( 
Id)) 
=)) 
table)) 
.)) 
Column)) %
<))% &
string))& ,
>)), -
())- .
type)). 2
:))2 3
$str))4 :
,)): ;
nullable))< D
:))D E
false))F K
)))K L
,))L M
UserId** 
=** 
table** "
.**" #
Column**# )
<**) *
string*** 0
>**0 1
(**1 2
type**2 6
:**6 7
$str**8 >
,**> ?
nullable**@ H
:**H I
false**J O
)**O P
,**P Q
	CreatedAt++ 
=++ 
table++  %
.++% &
Column++& ,
<++, -
DateTime++- 5
>++5 6
(++6 7
type++7 ;
:++; <
$str++= Z
,++Z [
nullable++\ d
:++d e
false++f k
)++k l
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% :
,//: ;
x//< =
=>//> @
x//A B
.//B C
Id//C E
)//E F
;//F G
}00 
)00 
;00 
}11 	
	protected33 
override33 
void33 
Down33  $
(33$ %
MigrationBuilder33% 5
migrationBuilder336 F
)33F G
{44 	
migrationBuilder55 
.55 
	DropTable55 &
(55& '
name66 
:66 
$str66 (
)66( )
;66) *
migrationBuilder88 
.88 

DropColumn88 '
(88' (
name99 
:99 
$str99 !
,99! "
table:: 
::: 
$str:: 
):: 
;::  
migrationBuilder<< 
.<< 
AlterColumn<< (
<<<( )
string<<) /
><</ 0
(<<0 1
name== 
:== 
$str== $
,==$ %
table>> 
:>> 
$str>> 
,>> 
type?? 
:?? 
$str?? 
,?? 
nullable@@ 
:@@ 
false@@ 
,@@  

oldClrTypeAA 
:AA 
typeofAA "
(AA" #
byteAA# '
[AA' (
]AA( )
)AA) *
,AA* +
oldTypeBB 
:BB 
$strBB  
)BB  !
;BB! "
migrationBuilderDD 
.DD 
AlterColumnDD (
<DD( )
stringDD) /
>DD/ 0
(DD0 1
nameEE 
:EE 
$strEE $
,EE$ %
tableFF 
:FF 
$strFF 
,FF 
typeGG 
:GG 
$strGG 
,GG 
nullableHH 
:HH 
falseHH 
,HH  

oldClrTypeII 
:II 
typeofII "
(II" #
byteII# '
[II' (
]II( )
)II) *
,II* +
oldTypeJJ 
:JJ 
$strJJ  
)JJ  !
;JJ! "
}KK 	
}LL 
}MM «
OD:\Programavimas\politik\back\Migrations\20211120124455_AddEmailChangeTokens.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class  
AddEmailChangeTokens -
:. /
	Migration0 9
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str )
,) *
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
type. 2
:2 3
$str4 :
,: ;
nullable< D
:D E
falseF K
)K L
,L M
UserId 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
NewEmail 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
	CreatedAt 
= 
table  %
.% &
Column& ,
<, -
DateTime- 5
>5 6
(6 7
type7 ;
:; <
$str= Z
,Z [
nullable\ d
:d e
falsef k
)k l
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% ;
,; <
x= >
=>? A
xB C
.C D
IdD F
)F G
;G H
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str )
)) *
;* +
} 	
} 
} Æ5
MD:\Programavimas\politik\back\Migrations\20211202171337_AddLikesAndReports.cs
	namespace 	
Politics
 
. 

Migrations 
{ 
public 

partial 
class 
AddLikesAndReports +
:, -
	Migration. 7
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

 
,

 
columns 
: 
table 
=> !
new" %
{ 
LikeId 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
UserId 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
StatementId 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% /
,/ 0
x1 2
=>3 5
x6 7
.7 8
LikeId8 >
)> ?
;? @
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
ReportId 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
type4 8
:8 9
$str: @
,@ A
nullableB J
:J K
falseL Q
)Q R
,R S
StatementId 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V
Description 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V

IsReviewed 
=  
table! &
.& '
Column' -
<- .
bool. 2
>2 3
(3 4
type4 8
:8 9
$str: C
,C D
nullableE M
:M N
falseO T
)T U
,U V
CreatedById 
=  !
table" '
.' (
Column( .
<. /
string/ 5
>5 6
(6 7
type7 ;
:; <
$str= C
,C D
nullableE M
:M N
falseO T
)T U
,U V
ReviewedById  
=! "
table# (
.( )
Column) /
</ 0
string0 6
>6 7
(7 8
type8 <
:< =
$str> D
,D E
nullableF N
:N O
trueP T
)T U
}   
,   
constraints!! 
:!! 
table!! "
=>!!# %
{"" 
table## 
.## 

PrimaryKey## $
(##$ %
$str##% 1
,##1 2
x##3 4
=>##5 7
x##8 9
.##9 :
ReportId##: B
)##B C
;##C D
table$$ 
.$$ 

ForeignKey$$ $
($$$ %
name%% 
:%% 
$str%% <
,%%< =
column&& 
:&& 
x&&  !
=>&&" $
x&&% &
.&&& '
CreatedById&&' 2
,&&2 3
principalTable'' &
:''& '
$str''( /
,''/ 0
principalColumn(( '
:((' (
$str(() 1
,((1 2
onDelete))  
:))  !
ReferentialAction))" 3
.))3 4
Cascade))4 ;
))); <
;))< =
table** 
.** 

ForeignKey** $
(**$ %
name++ 
:++ 
$str++ =
,++= >
column,, 
:,, 
x,,  !
=>,," $
x,,% &
.,,& '
ReviewedById,,' 3
,,,3 4
principalTable-- &
:--& '
$str--( /
,--/ 0
principalColumn.. '
:..' (
$str..) 1
,..1 2
onDelete//  
://  !
ReferentialAction//" 3
.//3 4
Restrict//4 <
)//< =
;//= >
}00 
)00 
;00 
migrationBuilder22 
.22 
CreateIndex22 (
(22( )
name33 
:33 
$str33 .
,33. /
table44 
:44 
$str44  
,44  !
column55 
:55 
$str55 %
)55% &
;55& '
migrationBuilder77 
.77 
CreateIndex77 (
(77( )
name88 
:88 
$str88 /
,88/ 0
table99 
:99 
$str99  
,99  !
column:: 
::: 
$str:: &
)::& '
;::' (
};; 	
	protected== 
override== 
void== 
Down==  $
(==$ %
MigrationBuilder==% 5
migrationBuilder==6 F
)==F G
{>> 	
migrationBuilder?? 
.?? 
	DropTable?? &
(??& '
name@@ 
:@@ 
$str@@ 
)@@ 
;@@ 
migrationBuilderBB 
.BB 
	DropTableBB &
(BB& '
nameCC 
:CC 
$strCC 
)CC  
;CC  !
}DD 	
}EE 
}FF Ï
6D:\Programavimas\politik\back\Model\ActivationToken.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
ActivationToken 
{ 
[ 
Required 
] 
public		 

string		 
Id		 
{		 
get		 
;		 
set		 
;		  
}		! "
[

 
Required

 
]

 
public 

string 
UserId 
{ 
get 
; 
set  #
;# $
}% &
[ 
Required 
] 
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} æ
7D:\Programavimas\politik\back\Model\EmailChangeToken.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
EmailChangeToken 
{ 
[ 
Required 
] 
public		 
string		 
Id		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
[

 
Required

 
]

 
public 
string 
UserId 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
] 
public 
string 
NewEmail 
{ 
get "
;" #
set$ '
;' (
}) *
[ 
Required 
] 
public 
DateTime 
	CreatedAt 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} ⁄
+D:\Programavimas\politik\back\Model\Like.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
Like 
{ 
[ 
Required 
] 
public 

string 
LikeId 
{ 
get 
; 
set  #
;# $
}% &
[		 
Required		 
]		 
public

 

string

 
UserId

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
[ 
Required 
] 
public 

string 
StatementId 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ˜
,D:\Programavimas\politik\back\Model\Party.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
Party 
{ 
[ 
Required 
] 
public		 

string		 
PartyId		 
{		 
get		 
;		  
set		! $
;		$ %
}		& '
[

 
Required

 
]

 
public 

string 
LongName 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
] 
public 

string 
	ShortName 
{ 
get !
;! "
set# &
;& '
}( )
[ 
Required 
] 
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
	UpdatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 

string 
CreatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
UpdatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

User 
	CreatedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

User 
	UpdatedBy 
{ 
get 
;  
set! $
;$ %
}& '
} 
} å
1D:\Programavimas\politik\back\Model\Politician.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 

Politician 
{ 
[ 
Required 
] 
public		 

string		 
PoliticianId		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
public

 

string

 
PartyId

 
{

 
get

 
;

  
set

! $
;

$ %
}

& '
public 

Party 
Party 
{ 
get 
; 
set !
;! "
}# $
[ 
Required 
] 
public 

string 
	FirstName 
{ 
get !
;! "
set# &
;& '
}( )
[ 
Required 
] 
public 

string 
LastName 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
] 
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
	UpdatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 

string 
CreatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
UpdatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

User 
	CreatedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

User 
	UpdatedBy 
{ 
get 
;  
set! $
;$ %
}& '
} 
} ŒG
8D:\Programavimas\politik\back\Model\PoliticsDbContext.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
PoliticsDbContext  
:! "
	DbContext# ,
{ 
public 

PoliticsDbContext 
( 
DbContextOptions -
<- .
PoliticsDbContext. ?
>? @
optionsA H
)H I
: 	
base
 
( 
options 
) 
{		 
}

 
public 

DbSet 
< 
User 
> 
Users 
{ 
get "
;" #
set$ '
;' (
}) *
public 

DbSet 
< 
Role 
> 
Roles 
{ 
get "
;" #
set$ '
;' (
}) *
public 

DbSet 
< 
Party 
> 
Parties 
{  !
get" %
;% &
set' *
;* +
}, -
public 

DbSet 
< 

Politician 
> 
Politicians (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 

DbSet 
< 
Tag 
> 
Tags 
{ 
get  
;  !
set" %
;% &
}' (
public 

DbSet 
< 
	Statement 
> 

Statements &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

DbSet 
< 
StatementTag 
> 
StatementTags ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 

DbSet 
< 
ActivationToken  
>  !
ActivationTokens" 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 

DbSet 
< 
EmailChangeToken !
>! "
EmailChangeTokens# 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
public 

DbSet 
< 
Like 
> 
Likes 
{ 
get "
;" #
set$ '
;' (
}) *
public 

DbSet 
< 
Report 
> 
Reports  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnModelCreating +
(+ ,
ModelBuilder, 8
modelBuilder9 E
)E F
{ 
modelBuilder 
. 
Entity 
< 
	Statement #
># $
($ %
)% &
.
 
HasMany 
( 
p 
=> 
p 
. 
Tags 
) 
.
 
WithMany 
( 
p 
=> 
p 
. 

Statements %
)% &
.
 
UsingEntity 
< 
StatementTag #
># $
($ %
j 
=> 
j 
. 
HasOne 
( 
st 
=> 
st  "
." #
Tag# &
)& '
. 
WithMany 
( 
t 
=>  
t! "
." #
StatementTags# 0
)0 1
.   
HasForeignKey    
(    !
pt  ! #
=>  $ &
pt  ' )
.  ) *
TagId  * /
)  / 0
,  0 1
j!! 
=>!! 
j!! 
."" 
HasOne"" 
("" 
st"" 
=>"" 
st""  "
.""" #
	Statement""# ,
)"", -
.## 
WithMany## 
(## 
p## 
=>##  
p##! "
.##" #
StatementTags### 0
)##0 1
.$$ 
HasForeignKey$$  
($$  !
st$$! #
=>$$$ &
st$$' )
.$$) *
StatementId$$* 5
)$$5 6
)$$6 7
;$$7 8
modelBuilder%% 
.%% 
Entity%% 
<%% 
Party%% 
>%%  
(%%  !
)%%! "
.&& 	
HasOne&&	 
(&& 
t&& 
=>&& 
t&& 
.&& 
	CreatedBy&&  
)&&  !
.'' 	
WithMany''	 
('' 
)'' 
.(( 	
HasForeignKey((	 
((( 
nameof(( 
((( 
Party(( #
.((# $
CreatedById(($ /
)((/ 0
)((0 1
;((1 2
modelBuilder)) 
.)) 
Entity)) 
<)) 
Party)) 
>))  
())  !
)))! "
.** 	
HasOne**	 
(** 
t** 
=>** 
t** 
.** 
	UpdatedBy**  
)**  !
.++ 	
WithMany++	 
(++ 
)++ 
.,, 	
HasForeignKey,,	 
(,, 
nameof,, 
(,, 
Party,, #
.,,# $
UpdatedById,,$ /
),,/ 0
),,0 1
;,,1 2
modelBuilder.. 
... 
Entity.. 
<.. 

Politician.. $
>..$ %
(..% &
)..& '
.// 	
HasOne//	 
(// 
t// 
=>// 
t// 
.// 
	CreatedBy//  
)//  !
.00 	
WithMany00	 
(00 
)00 
.11 	
HasForeignKey11	 
(11 
nameof11 
(11 

Politician11 (
.11( )
CreatedById11) 4
)114 5
)115 6
;116 7
modelBuilder22 
.22 
Entity22 
<22 

Politician22 $
>22$ %
(22% &
)22& '
.33 	
HasOne33	 
(33 
t33 
=>33 
t33 
.33 
	UpdatedBy33  
)33  !
.44 	
WithMany44	 
(44 
)44 
.55 	
HasForeignKey55	 
(55 
nameof55 
(55 

Politician55 (
.55( )
UpdatedById55) 4
)554 5
)555 6
;556 7
modelBuilder77 
.77 
Entity77 
<77 
	Statement77 #
>77# $
(77$ %
)77% &
.88 	
HasOne88	 
(88 
t88 
=>88 
t88 
.88 
	CreatedBy88  
)88  !
.99 	
WithMany99	 
(99 
)99 
.:: 	
HasForeignKey::	 
(:: 
nameof:: 
(:: 
	Statement:: '
.::' (
CreatedById::( 3
)::3 4
)::4 5
;::5 6
modelBuilder;; 
.;; 
Entity;; 
<;; 
	Statement;; #
>;;# $
(;;$ %
);;% &
.<< 	
HasOne<<	 
(<< 
t<< 
=><< 
t<< 
.<< 
	UpdatedBy<<  
)<<  !
.== 	
WithMany==	 
(== 
)== 
.>> 	
HasForeignKey>>	 
(>> 
nameof>> 
(>> 
	Statement>> '
.>>' (
UpdatedById>>( 3
)>>3 4
)>>4 5
;>>5 6
modelBuilder@@ 
.@@ 
Entity@@ 
<@@ 
Report@@  
>@@  !
(@@! "
)@@" #
.AA 	
HasOneAA	 
(AA 
tAA 
=>AA 
tAA 
.AA 
	CreatedByAA  
)AA  !
.BB 	
WithManyBB	 
(BB 
)BB 
.CC 	
HasForeignKeyCC	 
(CC 
nameofCC 
(CC 
ReportCC $
.CC$ %
CreatedByIdCC% 0
)CC0 1
)CC1 2
;CC2 3
modelBuilderDD 
.DD 
EntityDD 
<DD 
ReportDD  
>DD  !
(DD! "
)DD" #
.EE 	
HasOneEE	 
(EE 
tEE 
=>EE 
tEE 
.EE 

ReviewedByEE !
)EE! "
.FF 	
WithManyFF	 
(FF 
)FF 
.GG 	
HasForeignKeyGG	 
(GG 
nameofGG 
(GG 
ReportGG $
.GG$ %
ReviewedByIdGG% 1
)GG1 2
)GG2 3
;GG3 4
}HH 
}II 
}JJ ﬂ
-D:\Programavimas\politik\back\Model\Report.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
Report 
{ 
[ 
Required 
] 
public 

string 
ReportId 
{ 
get  
;  !
set" %
;% &
}' (
[		 
Required		 
]		 
public

 

string

 
StatementId

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
[ 
Required 
] 
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 

bool 

IsReviewed 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Required 
] 
public 

string 
CreatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

User 
	CreatedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

string 
ReviewedById 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 

User 

ReviewedBy 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ö
+D:\Programavimas\politik\back\Model\Role.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
Role 
{ 
[ 
Required 
] 
public 

string 
RoleId 
{ 
get 
; 
set  #
;# $
}% &
[		 
Required		 
]		 
public

 

string

 
Name

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
} 
} ©
0D:\Programavimas\politik\back\Model\Statement.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
	Statement 
{ 
[		 
Required		 
]		 
public

 

string

 
StatementId

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
[ 
Required 
] 
public 

string 
PoliticianId 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
Required 
] 
public 

string 
Link 
{ 
get 
; 
set !
;! "
}# $
[ 
Required 
] 
public 

string 
Description 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 

string 
CreatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
? 
UpdatedById 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
Required 
] 
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
	UpdatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 


Politician 

Politician  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

User 
	CreatedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

User 
	UpdatedBy 
{ 
get 
;  
set! $
;$ %
}& '
public 

ICollection 
< 
Tag 
> 
Tags  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

List 
< 
StatementTag 
> 
StatementTags +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
} 
} â
3D:\Programavimas\politik\back\Model\StatementTag.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
StatementTag 
{ 
public 

string 
StatementTagId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 

string 
StatementId 
{ 
get  #
;# $
set% (
;( )
}* +
public 

string 
TagId 
{ 
get 
; 
set "
;" #
}$ %
public 

	Statement 
	Statement 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 

Tag		 
Tag		 
{		 
get		 
;		 
set		 
;		 
}		  
}

 
} ¢
*D:\Programavimas\politik\back\Model\Tag.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
Tag 
{ 
public 

string 
TagId 
{ 
get 
; 
set "
;" #
}$ %
public		 

string		 
Name		 
{		 
get		 
;		 
set		 !
;		! "
}		# $
public

 

DateTime

 
	CreatedAt

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 

string 
CreatedById 
{ 
get  #
;# $
set% (
;( )
}* +
public 

User 
	CreatedBy 
{ 
get 
; 
set  #
;# $
}% &
public 

ICollection 
< 
	Statement  
>  !

Statements" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 

List 
< 
StatementTag 
> 
StatementTags +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
} 
} ﬁ
+D:\Programavimas\politik\back\Model\User.cs
	namespace 	
Politics
 
. 
Model 
{ 
public 
class	 
User 
{ 
[ 
Required 
] 
public		 

string		 
UserId		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
[

 
Required

 
]

 
public 

string 
Email 
{ 
get 
; 
set "
;" #
}$ %
[ 
Required 
] 
public 

string 
DisplayName 
{ 
get  #
;# $
set% (
;( )
}* +
[ 
Required 
] 
public 

byte 
[ 
] 
PasswordHash 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
Required 
] 
public 

byte 
[ 
] 
PasswordSalt 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
Required 
] 
public 

string 
RoleId 
{ 
get 
; 
set  #
;# $
}% &
public 

Role 
Role 
{ 
get 
; 
set 
;  
}! "
[ 
Required 
] 
public 

bool 
	Activated 
{ 
get 
;  
set! $
;$ %
}& '
[ 
Required 
] 
public 

DateTime 
	CreatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
public 

DateTime 
	UpdatedAt 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ˛	
(D:\Programavimas\politik\back\Program.cs
	namespace 	
Politics
 
{ 
public 
class	 
Program 
{ 
public 

static 
void 
Main 
( 
string "
[" #
]# $
args% )
)) *
{		 
CreateHostBuilder

 
(

 
args

 
)

 
.

 
Build

 #
(

# $
)

$ %
.

% &
Run

& )
(

) *
)

* +
;

+ ,
} 
public 

static 
IHostBuilder 
CreateHostBuilder 0
(0 1
string1 7
[7 8
]8 9
args: >
)> ?
=>@ B
Host 
.  
CreateDefaultBuilder !
(! "
args" &
)& '
. $
ConfigureWebHostDefaults %
(% &

webBuilder& 0
=>1 3
{ 

webBuilder 
. 

UseStartup #
<# $
Startup$ +
>+ ,
(, -
)- .
;. /
} 
) 
; 
} 
} ·π
5D:\Programavimas\politik\back\Services\AuthService.cs
	namespace

 	
Politics


 
.

 
Services

 
{ 
public 
class	 
AuthService 
: 
IAuthService )
{ 
private 
readonly 
PoliticsDbContext &
_context' /
;/ 0
private 
readonly 
IMapper 
_mapper $
;$ %
public 

AuthService 
( 
PoliticsDbContext (
context) 0
,0 1
IMapper2 9
mapper: @
)@ A
{ 
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 
public 

async 
Task 
< 
User 
> 
Login !
(! "
string" (
email) .
,. /
string0 6
password7 ?
)? @
{ 
var 	
user
 
= 
await 
_context 
.  
Users  %
.% &
Include& -
(- .
user. 2
=>3 5
user6 :
.: ;
Role; ?
)? @
.@ A
FirstOrDefaultAsyncA T
(T U
uU V
=>W Y
uZ [
.[ \
Email\ a
==b d
emaile j
)j k
;k l
if 
(	 

user
 
== 
null 
) 
{ 
return 
null 
; 
} 
if 
(	 

!
 
VerifyPassword 
( 
password "
," #
user$ (
.( )
PasswordHash) 5
,5 6
user7 ;
.; <
PasswordSalt< H
)H I
)I J
{   
return!! 
null!! 
;!! 
}"" 
return$$ 
user$$ 
;$$ 
}%% 
private'' 
static'' 
bool'' 
VerifyPassword'' &
(''& '
string''' -
password''. 6
,''6 7
byte''8 <
[''< =
]''= >
passwordHash''? K
,''K L
byte''M Q
[''Q R
]''R S
passwordSalt''T `
)''` a
{(( 
using)) 
()) 
var)) 
hmac)) 
=)) 
new)) 
System)) "
.))" #
Security))# +
.))+ ,
Cryptography)), 8
.))8 9

HMACSHA512))9 C
())C D
passwordSalt))D P
)))P Q
)))Q R
{** 
var++ 
computedHash++ 
=++ 
hmac++ 
.++  
ComputeHash++  +
(+++ ,
System++, 2
.++2 3
Text++3 7
.++7 8
Encoding++8 @
.++@ A
UTF8++A E
.++E F
GetBytes++F N
(++N O
password++O W
)++W X
)++X Y
;++Y Z
if,, 

(,, 
!,, 
computedHash,, 
.,, 
SequenceEqual,, '
(,,' (
passwordHash,,( 4
),,4 5
),,5 6
{-- 	
return..
 
false.. 
;.. 
}// 	
}00 
return11 
true11 
;11 
}22 
public44 

async44 
Task44 
<44 
bool44 
>44 

UserExists44 &
(44& '
string44' -
email44. 3
)443 4
{55 
return66 
await66 
_context66 
.66 
Users66 !
.66! "
AnyAsync66" *
(66* +
x66+ ,
=>66- /
x660 1
.661 2
Email662 7
==668 :
email66; @
&&66A C
x66D E
.66E F
	Activated66F O
)66O P
;66P Q
}77 
public88 

async88 
Task88 
<88 
User88 
>88 
Register88 $
(88$ %
User88% )
user88* .
,88. /
string880 6
password887 ?
)88? @
{99 
var:: 	
role::
 
=:: 
await:: 
_context:: 
.::  
Roles::  %
.::% & 
SingleOrDefaultAsync::& :
(::: ;
role::; ?
=>::@ B
role::C G
.::G H
Name::H L
==::M O
$str::P V
)::V W
;::W X
CreatePasswordHash;; 
(;; 
password;; !
,;;! "
out;;# &
byte;;' +
[;;+ ,
];;, -
passwordHash;;. :
,;;: ;
out;;< ?
byte;;@ D
[;;D E
];;E F
passwordSalt;;G S
);;S T
;;;T U
user<< 

.<<
 
RoleId<< 
=<< 
role<< 
.<< 
RoleId<< 
;<<  
user== 

.==
 
UserId== 
=== 
Guid== 
.== 
NewGuid==  
(==  !
)==! "
.==" #
ToString==# +
(==+ ,
)==, -
;==- .
user>> 

.>>
 
PasswordHash>> 
=>> 
passwordHash>> &
;>>& '
user?? 

.??
 
PasswordSalt?? 
=?? 
passwordSalt?? &
;??& '
user@@ 

.@@
 
	CreatedAt@@ 
=@@ 
DateTime@@ 
.@@  
Now@@  #
;@@# $
userAA 

.AA
 
	UpdatedAtAA 
=AA 
DateTimeAA 
.AA  
NowAA  #
;AA# $
awaitCC 
_contextCC 
.CC 
UsersCC 
.CC 
AddAsyncCC #
(CC# $
userCC$ (
)CC( )
;CC) *
awaitDD 
_contextDD 
.DD 
SaveChangesAsyncDD %
(DD% &
)DD& '
;DD' (
returnFF 
userFF 
;FF 
}GG 
privateHH 
staticHH 
voidHH 
CreatePasswordHashHH *
(HH* +
stringHH+ 1
passwordHH2 :
,HH: ;
outHH< ?
byteHH@ D
[HHD E
]HHE F
passwordHashHHG S
,HHS T
outHHU X
byteHHY ]
[HH] ^
]HH^ _
passwordSaltHH` l
)HHl m
{II 
usingJJ 
varJJ 
hmacJJ 
=JJ 
newJJ 
SystemJJ !
.JJ! "
SecurityJJ" *
.JJ* +
CryptographyJJ+ 7
.JJ7 8

HMACSHA512JJ8 B
(JJB C
)JJC D
;JJD E
passwordSaltKK 
=KK 
hmacKK 
.KK 
KeyKK 
;KK 
passwordHashLL 
=LL 
hmacLL 
.LL 
ComputeHashLL %
(LL% &
SystemLL& ,
.LL, -
TextLL- 1
.LL1 2
EncodingLL2 :
.LL: ;
UTF8LL; ?
.LL? @
GetBytesLL@ H
(LLH I
passwordLLI Q
)LLQ R
)LLR S
;LLS T
}MM 
publicNN 

asyncNN 
TaskNN 
<NN 
ActivationTokenNN %
>NN% &#
GenerateActivationTokenNN' >
(NN> ?
stringNN? E
userIdNNF L
)NNL M
{OO 
varPP 	
tokenPP
 
=PP 
newPP 
ActivationTokenPP %
(PP% &
)PP& '
{QQ 
IdRR 

=RR 
GuidRR 
.RR 
NewGuidRR 
(RR 
)RR 
.RR 
ToStringRR $
(RR$ %
)RR% &
,RR& '
UserIdSS 
=SS 
userIdSS 
,SS 
	CreatedAtTT 
=TT 
DateTimeTT 
.TT 
NowTT  
,TT  !
}UU 
;UU 
awaitWW 
_contextWW 
.WW 
ActivationTokensWW %
.WW% &
AddAsyncWW& .
(WW. /
tokenWW/ 4
)WW4 5
;WW5 6
awaitXX 
_contextXX 
.XX 
SaveChangesAsyncXX %
(XX% &
)XX& '
;XX' (
returnYY 
tokenYY 
;YY 
}ZZ 
public[[ 

async[[ 
Task[[ 
<[[ 
User[[ 
>[[ 
ActivateUser[[ (
([[( )
string[[) /
tokenId[[0 7
)[[7 8
{\\ 
var]] 	
token]]
 
=]] 
await]] 
_context]]  
.]]  !
ActivationTokens]]! 1
.]]1 2
SingleAsync]]2 =
(]]= >
a]]> ?
=>]]@ B
a]]C D
.]]D E
Id]]E G
==]]H J
tokenId]]K R
)]]R S
;]]S T
var^^ 	
user^^
 
=^^ 
await^^ 
_context^^ 
.^^  
Users^^  %
.^^% &
	FindAsync^^& /
(^^/ 0
token^^0 5
.^^5 6
UserId^^6 <
)^^< =
;^^= >
user__ 

.__
 
	Activated__ 
=__ 
true__ 
;__ 
_context`` 
.`` 
ActivationTokens`` 
.``  
Remove``  &
(``& '
token``' ,
)``, -
;``- .
awaitaa 
_contextaa 
.aa 
SaveChangesAsyncaa %
(aa% &
)aa& '
;aa' (
returnbb 
userbb 
;bb 
}cc 
publicee 

asyncee 
Taskee 
<ee 
UserProfileDtoee $
>ee$ %
GetUserByIdee& 1
(ee1 2
stringee2 8
userIdee9 ?
)ee? @
{ff 
vargg 	
usergg
 
=gg 
awaitgg 
_contextgg 
.gg  
Usersgg  %
.gg% &
Includegg& -
(gg- .
usergg. 2
=>gg3 5
usergg6 :
.gg: ;
Rolegg; ?
)gg? @
.gg@ A
FirstOrDefaultAsyncggA T
(ggT U
userggU Y
=>ggZ \
usergg] a
.gga b
UserIdggb h
==ggi k
userIdggl r
)ggr s
;ggs t
returnhh 
_mapperhh 
.hh 
Maphh 
<hh 
Userhh 
,hh 
UserProfileDtohh -
>hh- .
(hh. /
userhh/ 3
)hh3 4
;hh4 5
}ii 
publickk 

asynckk 
Taskkk 
<kk 
UserProfileDtokk $
>kk$ %
GetUserByEmailkk& 4
(kk4 5
stringkk5 ;
emailkk< A
)kkA B
{ll 
varmm 	
usermm
 
=mm 
awaitmm 
_contextmm 
.mm  
Usersmm  %
.mm% &
Includemm& -
(mm- .
usermm. 2
=>mm3 5
usermm6 :
.mm: ;
Rolemm; ?
)mm? @
.mm@ A
FirstOrDefaultAsyncmmA T
(mmT U
usermmU Y
=>mmZ \
usermm] a
.mma b
Emailmmb g
==mmh j
emailmmk p
&&mmq s
usermmt x
.mmx y
	Activated	mmy Ç
)
mmÇ É
;
mmÉ Ñ
returnnn 
_mappernn 
.nn 
Mapnn 
<nn 
Usernn 
,nn 
UserProfileDtonn -
>nn- .
(nn. /
usernn/ 3
)nn3 4
;nn4 5
}oo 
publicqq 

asyncqq 
Taskqq 
<qq 
EmailChangeTokenqq &
>qq& '$
GenerateEmailChangeTokenqq( @
(qq@ A
stringqqA G
userIdqqH N
,qqN O
stringqqP V
newEmailqqW _
)qq_ `
{rr 
varss 	
tokenss
 
=ss 
newss 
EmailChangeTokenss &
(ss& '
)ss' (
{tt 
Iduu 

=uu 
Guiduu 
.uu 
NewGuiduu 
(uu 
)uu 
.uu 
ToStringuu $
(uu$ %
)uu% &
,uu& '
UserIdvv 
=vv 
userIdvv 
,vv 
NewEmailww 
=ww 
newEmailww 
,ww 
	CreatedAtxx 
=xx 
DateTimexx 
.xx 
Nowxx  
}yy 
;yy 
await{{ 
_context{{ 
.{{ 
EmailChangeTokens{{ &
.{{& '
AddAsync{{' /
({{/ 0
token{{0 5
){{5 6
;{{6 7
await|| 
_context|| 
.|| 
SaveChangesAsync|| %
(||% &
)||& '
;||' (
return}} 
token}} 
;}} 
}~~ 
public
ÄÄ 

async
ÄÄ 
Task
ÄÄ 
<
ÄÄ 
User
ÄÄ 
>
ÄÄ 
UpdateEmail
ÄÄ '
(
ÄÄ' (
string
ÄÄ( .
tokenId
ÄÄ/ 6
)
ÄÄ6 7
{
ÅÅ 
var
ÇÇ 	
token
ÇÇ
 
=
ÇÇ 
await
ÇÇ 
_context
ÇÇ  
.
ÇÇ  !
EmailChangeTokens
ÇÇ! 2
.
ÇÇ2 3!
FirstOrDefaultAsync
ÇÇ3 F
(
ÇÇF G
token
ÇÇG L
=>
ÇÇM O
token
ÇÇP U
.
ÇÇU V
Id
ÇÇV X
==
ÇÇY [
tokenId
ÇÇ\ c
)
ÇÇc d
;
ÇÇd e
if
ÉÉ 
(
ÉÉ	 

token
ÉÉ
 
is
ÉÉ 
null
ÉÉ 
)
ÉÉ 
{
ÑÑ 
return
ÖÖ 
null
ÖÖ 
;
ÖÖ 
}
ÜÜ 
var
áá 	
user
áá
 
=
áá 
await
áá 
_context
áá 
.
áá  
Users
áá  %
.
áá% &!
FirstOrDefaultAsync
áá& 9
(
áá9 :
user
áá: >
=>
áá? A
user
ááB F
.
ááF G
UserId
ááG M
==
ááN P
token
ááQ V
.
ááV W
UserId
ááW ]
)
áá] ^
;
áá^ _
if
àà 
(
àà	 

user
àà
 
is
àà 
null
àà 
)
àà 
{
ââ 
return
ää 
null
ää 
;
ää 
}
ãã 
if
åå 
(
åå	 

token
åå
 
.
åå 
	CreatedAt
åå 
.
åå 
AddDays
åå !
(
åå! "
$num
åå" #
)
åå# $
>
åå% &
DateTime
åå' /
.
åå/ 0
Now
åå0 3
)
åå3 4
{
çç 
user
éé 
.
éé 
Email
éé 
=
éé 
token
éé 
.
éé 
NewEmail
éé #
;
éé# $
_context
èè 
.
èè 
EmailChangeTokens
èè "
.
èè" #
Remove
èè# )
(
èè) *
token
èè* /
)
èè/ 0
;
èè0 1
await
êê 
_context
êê 
.
êê 
SaveChangesAsync
êê '
(
êê' (
)
êê( )
;
êê) *
}
ëë 
return
íí 
user
íí 
;
íí 
}
ìì 
public
ïï 

async
ïï 
Task
ïï 
<
ïï 
UserProfileDto
ïï $
>
ïï$ %
ChangePassword
ïï& 4
(
ïï4 5
string
ïï5 ;
userId
ïï< B
,
ïïB C
string
ïïD J
newPassword
ïïK V
)
ïïV W
{
ññ 
var
óó 	
user
óó
 
=
óó 
await
óó 
_context
óó 
.
óó  
Users
óó  %
.
óó% &!
FirstOrDefaultAsync
óó& 9
(
óó9 :
user
óó: >
=>
óó? A
user
óóB F
.
óóF G
UserId
óóG M
==
óóN P
userId
óóQ W
)
óóW X
;
óóX Y
if
òò 
(
òò	 

user
òò
 
is
òò 
null
òò 
)
òò 
{
ôô 
return
öö 
null
öö 
;
öö 
}
õõ  
CreatePasswordHash
úú 
(
úú 
newPassword
úú $
,
úú$ %
out
úú& )
byte
úú* .
[
úú. /
]
úú/ 0
passwordHash
úú1 =
,
úú= >
out
úú? B
byte
úúC G
[
úúG H
]
úúH I
passwordSalt
úúJ V
)
úúV W
;
úúW X
user
ùù 

.
ùù
 
PasswordHash
ùù 
=
ùù 
passwordHash
ùù &
;
ùù& '
user
ûû 

.
ûû
 
PasswordSalt
ûû 
=
ûû 
passwordSalt
ûû &
;
ûû& '
await
üü 
_context
üü 
.
üü 
SaveChangesAsync
üü %
(
üü% &
)
üü& '
;
üü' (
return
†† 
_mapper
†† 
.
†† 
Map
†† 
<
†† 
User
†† 
,
†† 
UserProfileDto
†† -
>
††- .
(
††. /
user
††/ 3
)
††3 4
;
††4 5
}
°° 
public
££ 

async
££ 
Task
££ 
<
££ 
UserProfileDto
££ $
>
££$ %
ChangeDisplayName
££& 7
(
££7 8
string
££8 >
userId
££? E
,
££E F
string
££G M
newDisplayName
££N \
)
££\ ]
{
§§ 
var
•• 	
user
••
 
=
•• 
await
•• 
_context
•• 
.
••  
Users
••  %
.
••% &
Include
••& -
(
••- .
user
••. 2
=>
••3 5
user
••6 :
.
••: ;
Role
••; ?
)
••? @
.
••@ A!
FirstOrDefaultAsync
••A T
(
••T U
user
••U Y
=>
••Z \
user
••] a
.
••a b
UserId
••b h
==
••i k
userId
••l r
)
••r s
;
••s t
if
¶¶ 
(
¶¶	 

user
¶¶
 
is
¶¶ 
null
¶¶ 
)
¶¶ 
{
ßß 
return
®® 
null
®® 
;
®® 
}
©© 
user
™™ 

.
™™
 
DisplayName
™™ 
=
™™ 
newDisplayName
™™ '
;
™™' (
await
´´ 
_context
´´ 
.
´´ 
SaveChangesAsync
´´ %
(
´´% &
)
´´& '
;
´´' (
return
¨¨ 
_mapper
¨¨ 
.
¨¨ 
Map
¨¨ 
<
¨¨ 
User
¨¨ 
,
¨¨ 
UserProfileDto
¨¨ -
>
¨¨- .
(
¨¨. /
user
¨¨/ 3
)
¨¨3 4
;
¨¨4 5
}
≠≠ 
public
ÆÆ 

async
ÆÆ 
Task
ÆÆ 
<
ÆÆ 
bool
ÆÆ 
>
ÆÆ 
MakeModerator
ÆÆ )
(
ÆÆ) *
string
ÆÆ* 0
id
ÆÆ1 3
)
ÆÆ3 4
{
ØØ 
var
∞∞ 	
user
∞∞
 
=
∞∞ 
await
∞∞ 
_context
∞∞ 
.
∞∞  
Users
∞∞  %
.
∞∞% &"
SingleOrDefaultAsync
∞∞& :
(
∞∞: ;
user
∞∞; ?
=>
∞∞@ B
user
∞∞C G
.
∞∞G H
UserId
∞∞H N
==
∞∞O Q
id
∞∞R T
)
∞∞T U
;
∞∞U V
if
±± 
(
±±	 

user
±±
 
is
±± 
null
±± 
)
±± 
{
≤≤ 
return
≥≥ 
false
≥≥ 
;
≥≥ 
}
¥¥ 
var
µµ 	
role
µµ
 
=
µµ 
await
µµ 
_context
µµ 
.
µµ  
Roles
µµ  %
.
µµ% &!
FirstOrDefaultAsync
µµ& 9
(
µµ9 :
role
µµ: >
=>
µµ? A
role
µµB F
.
µµF G
Name
µµG K
==
µµL N
$str
µµO T
)
µµT U
;
µµU V
if
∂∂ 
(
∂∂	 

role
∂∂
 
is
∂∂ 
null
∂∂ 
)
∂∂ 
{
∑∑ 
return
∏∏ 
false
∏∏ 
;
∏∏ 
}
ππ 
user
∫∫ 

.
∫∫
 
Role
∫∫ 
=
∫∫ 
role
∫∫ 
;
∫∫ 
await
ªª 
_context
ªª 
.
ªª 
SaveChangesAsync
ªª %
(
ªª% &
)
ªª& '
;
ªª' (
return
ºº 
true
ºº 
;
ºº 
}
ΩΩ 
public
ææ 

async
ææ 
Task
ææ 
<
ææ 
PaginatedList
ææ #
<
ææ# $
UserProfileDto
ææ$ 2
>
ææ2 3
>
ææ3 4
GetUsers
ææ5 =
(
ææ= >
int
ææ> A
?
ææA B

pageNumber
ææC M
,
ææM N
int
ææO R
?
ææR S
pageSize
ææT \
,
ææ\ ]
string
ææ^ d
?
ææd e
search
ææf l
)
ææl m
{
øø 
var
¿¿ 	
users
¿¿
 
=
¿¿ 
_context
¿¿ 
.
¿¿ 
Users
¿¿  
.
¿¿  !
Include
¿¿! (
(
¿¿( )
user
¿¿) -
=>
¿¿. 0
user
¿¿1 5
.
¿¿5 6
Role
¿¿6 :
)
¿¿: ;
;
¿¿; <
if
¡¡ 
(
¡¡	 

search
¡¡
 
is
¡¡ 
not
¡¡ 
null
¡¡ 
)
¡¡ 
{
¬¬ 
var
√√ 
lowercaseSearch
√√ 
=
√√ 
search
√√ $
.
√√$ %
ToLower
√√% ,
(
√√, -
)
√√- .
;
√√. /
users
ƒƒ 
=
ƒƒ 
users
ƒƒ 
.
ƒƒ 
Where
ƒƒ 
(
ƒƒ 
user
ƒƒ  
=>
ƒƒ! #
(
ƒƒ$ %
(
≈≈
 
user
≈≈ 
.
≈≈ 
DisplayName
≈≈ 
.
≈≈ 
ToLower
≈≈ #
(
≈≈# $
)
≈≈$ %
)
≈≈% &
.
≈≈& '
Contains
≈≈' /
(
≈≈/ 0
lowercaseSearch
≈≈0 ?
)
≈≈? @
||
≈≈A C
user
∆∆
 
.
∆∆ 
Email
∆∆ 
.
∆∆ 
ToLower
∆∆ 
(
∆∆ 
)
∆∆ 
.
∆∆ 
Contains
∆∆ '
(
∆∆' (
lowercaseSearch
∆∆( 7
)
∆∆7 8
)
«« 	
)
««	 

.
««
 
Include
«« 
(
«« 
user
«« 
=>
«« 
user
«« 
.
««  
Role
««  $
)
««$ %
;
««% &
}
»» 
var
…… 	
paginatedUsers
……
 
=
…… 
await
……  
PaginatedList
……! .
<
……. /
User
……/ 3
>
……3 4
.
……4 5
CreateAsync
……5 @
(
……@ A
users
……A F
,
……F G

pageNumber
……H R
??
……S U
$num
……V W
,
……W X
pageSize
……Y a
??
……b d
$num
……e g
)
……g h
;
……h i
return
   
_mapper
   
.
   
Map
   
<
   
PaginatedList
   &
<
  & '
User
  ' +
>
  + ,
,
  , -
PaginatedList
  . ;
<
  ; <
UserProfileDto
  < J
>
  J K
>
  K L
(
  L M
paginatedUsers
  M [
)
  [ \
;
  \ ]
}
ÀÀ 
}
ÃÃ 
}ÕÕ ∏*
5D:\Programavimas\politik\back\Services\EmailSender.cs
	namespace 	
Politics
 
. 
Services 
{		 
public

 
class

	 
EmailSender

 
:

 
IEmailSender

 )
{ 
public 

EmailSender 
( 
IConfiguration %
config& ,
), -
{ 
_config 
= 
config 
; 
} 
private 
readonly 
IConfiguration #
_config$ +
;+ ,
public 

async 
Task 
< 
Response 
> 
SendActivationEmail  3
(3 4
User4 8
	recipient9 B
,B C
ActivationTokenD S
tokenT Y
)Y Z
{ 
var 	
subject
 
= 
$str 6
;6 7
var 	
to
 
= 
new 
EmailAddress 
(  
	recipient  )
.) *
Email* /
)/ 0
;0 1
var 	
plainTextContent
 
= 
$" 
$str '
{' (
	recipient( 1
.1 2
DisplayName2 =
}= >
$str> ?
"? @
+A B
$str
 T
+U V
$str
 B
;B C
var 	
htmlContent
 
= 
$" 
$str J
{J K
	recipientK T
.T U
DisplayNameU `
}` a
$stra k
"k l
+m n
$str
 N
+O P
$"
 
$str c
{c d
tokend i
.i j
Idj l
}l m
$str	m ã
"
ã å
+
ç é
$str
 U
;U V
return 
await 
SendMail 
( 
subject #
,# $
to% '
,' (
plainTextContent) 9
,9 :
htmlContent; F
)F G
;G H
} 
public   

async   
Task   
<   
Response   
>   !
SendEmailConfirmation    5
(  5 6
UserProfileDto  6 D
	recipient  E N
,  N O
string  P V
newEmail  W _
,  _ `
EmailChangeToken  a q
token  r w
)  w x
{!! 
var"" 	
subject""
 
="" 
$str"" R
;""R S
var## 	
to##
 
=## 
new## 
EmailAddress## 
(##  
newEmail##  (
)##( )
;##) *
var$$ 	
plainTextContent$$
 
=$$ 
$"$$ 
$str$$ '
{$$' (
	recipient$$( 1
.$$1 2
DisplayName$$2 =
}$$= >
$str$$> ?
"$$? @
+$$A B
$str%%
 K
+%%L M
$str&&
 r
;&&r s
var'' 	
htmlContent''
 
='' 
$"'' 
$str'' J
{''J K
	recipient''K T
.''T U
DisplayName''U `
}''` a
$str''a k
"''k l
+''m n
$str((
 N
+((O P
$"))
 
$str)) m
{))m n
token))n s
.))s t
Id))t v
}))v w
$str	))w ï
"
))ï ñ
+
))ó ò
$str**
 U
;**U V
return++ 
await++ 
SendMail++ 
(++ 
subject++ #
,++# $
to++% '
,++' (
plainTextContent++) 9
,++9 :
htmlContent++; F
)++F G
;++G H
},, 
private.. 
async.. 
Task.. 
<.. 
Response.. 
>..  
SendMail..! )
(..) *
string..* 0
subject..1 8
,..8 9
EmailAddress..: F
to..G I
,..I J
string..K Q
plainTextContent..R b
,..b c
string..d j
htmlContent..k v
)..v w
{// 
var00 	
apiKey00
 
=00 
_config00 
.00 
GetValue00 #
<00# $
string00$ *
>00* +
(00+ ,
$str00, <
)00< =
;00= >
var11 	
client11
 
=11 
new11 
SendGridClient11 %
(11% &
apiKey11& ,
)11, -
;11- .
var22 	
from22
 
=22 
new22 
EmailAddress22 !
(22! "
$str22" D
,22D E
$str22F O
)22O P
;22P Q
var33 	
msg33
 
=33 

MailHelper33 
.33 
CreateSingleEmail33 ,
(33, -
from33- 1
,331 2
to333 5
,335 6
subject337 >
,33> ?
plainTextContent33@ P
,33P Q
htmlContent33R ]
)33] ^
;33^ _
var44 	
response44
 
=44 
await44 
client44 !
.44! "
SendEmailAsync44" 0
(440 1
msg441 4
)444 5
;445 6
return55 
response55 
;55 
}66 
}88 
}99  
6D:\Programavimas\politik\back\Services\IAuthService.cs
	namespace 	
Politics
 
. 
Services 
{ 
public 
	interface	 
IAuthService 
{		 
Task

 
<

 	
User

	 
>

 
Register

 
(

 
User

 
user

 !
,

! "
string

# )
password

* 2
)

2 3
;

3 4
Task 
< 	
ActivationToken	 
> #
GenerateActivationToken 1
(1 2
string2 8
UserId9 ?
)? @
;@ A
Task 
< 	
User	 
> 
ActivateUser 
( 
string "
tokenId# *
)* +
;+ ,
Task 
< 	
User	 
> 
Login 
( 
string 
email !
,! "
string# )
password* 2
)2 3
;3 4
Task 
< 	
bool	 
> 

UserExists 
( 
string  
email! &
)& '
;' (
Task 
< 	
UserProfileDto	 
> 
GetUserByEmail '
(' (
string( .
email/ 4
)4 5
;5 6
Task 
< 	
UserProfileDto	 
> 
GetUserById $
($ %
string% +
userId, 2
)2 3
;3 4
Task 
< 	
User	 
> 
UpdateEmail 
( 
string !
tokenId" )
)) *
;* +
Task 
< 	
EmailChangeToken	 
> $
GenerateEmailChangeToken 3
(3 4
string4 :
userId; A
,A B
stringC I
newEmailJ R
)R S
;S T
Task 
< 	
UserProfileDto	 
> 
ChangePassword '
(' (
string( .
userId/ 5
,5 6
string7 =
newPassword> I
)I J
;J K
Task 
< 	
UserProfileDto	 
> 
ChangeDisplayName *
(* +
string+ 1
userId2 8
,8 9
string: @
newDisplayNameA O
)O P
;P Q
Task 
< 	
bool	 
> 
MakeModerator 
( 
string #
id$ &
)& '
;' (
Task 
< 	
PaginatedList	 
< 
UserProfileDto %
>% &
>& '
GetUsers( 0
(0 1
int1 4
?4 5

pageNumber6 @
,@ A
intB E
?E F
pageSizeG O
,O P
stringQ W
?W X
searchY _
)_ `
;` a
} 
} √
6D:\Programavimas\politik\back\Services\IEmailSender.cs
	namespace 	
Politics
 
. 
Services 
{ 
public 
	interface	 
IEmailSender 
{		 
Task

 
<

 	
Response

	 
>

 
SendActivationEmail

 &
(

& '
User

' +
	recipient

, 5
,

5 6
ActivationToken

7 F
token

G L
)

L M
;

M N
Task 
< 	
Response	 
> !
SendEmailConfirmation (
(( )
UserProfileDto) 7
	recipient8 A
,A B
stringC I
newEmailJ R
,R S
EmailChangeTokenT d
tokene j
)j k
;k l
} 
} ç=
(D:\Programavimas\politik\back\Startup.cs
	namespace 	
Politics
 
{ 
public 
class	 
Startup 
{ 
public 

Startup 
( 
IConfiguration !
configuration" /
)/ 0
{ 
Configuration 
= 
configuration #
;# $
} 
public 

IConfiguration 
Configuration '
{( )
get* -
;- .
}/ 0
public 

void 
ConfigureServices !
(! "
IServiceCollection" 4
services5 =
)= >
{ 
services 
. 
AddDbContext 
< 
PoliticsDbContext -
>- .
(. /
options/ 6
=>7 9
options 
. 
	UseNpgsql 
(  
Configuration  -
.- .
GetConnectionString. A
(A B
$strB T
)T U
)U V
)V W
;W X
services!! 
.!! 
AddCors!! 
(!! 
options!! 
=>!! !
options!!" )
.!!) *
	AddPolicy!!* 3
(!!3 4
$str"" 
,"" 
builder## 
=>## 
{$$ 	
builder%%
 
.%% 
WithOrigins%% 
(%% 
$str%% 5
,%%5 6
$str%%7 X
)%%X Y
.&& 
AllowAnyMethod&& 
(&&  
)&&  !
.'' 
AllowAnyHeader'' 
(''  
)''  !
.(( 
AllowCredentials(( !
(((! "
)((" #
.)) 
WithExposedHeaders)) #
())# $
$str))$ 2
)))2 3
;))3 4
}** 	
)++ 
)++ 
;++ 	
var-- 	
mapperConfig--
 
=-- 
new-- 
MapperConfiguration-- 0
(--0 1
config--1 7
=>--8 :
{.. 
config// 
.// 

AddProfile// 
(// 
new// 
MappingProfile// ,
(//, -
)//- .
)//. /
;/// 0
}00 
)00 
;00 	
IMapper22 
mapper22 
=22 
mapperConfig22 #
.22# $
CreateMapper22$ 0
(220 1
)221 2
;222 3
services33 
.33 
AddSingleton33 
(33 
mapper33 "
)33" #
;33# $
services44 
.44 
AddControllers44 
(44 
)44 
;44  
services55 
.55 
	AddScoped55 
<55 "
IPoliticiansRepository55 /
,55/ 0!
PoliticiansRepository551 F
>55F G
(55G H
)55H I
;55I J
services66 
.66 
	AddScoped66 
<66 
IPartiesRepository66 +
,66+ ,
PartiesRepository66- >
>66> ?
(66? @
)66@ A
;66A B
services77 
.77 
	AddScoped77 
<77 !
IStatementsRepository77 .
,77. / 
StatementsRepository770 D
>77D E
(77E F
)77F G
;77G H
services88 
.88 
	AddScoped88 
<88 
ITagsRepository88 (
,88( )
TagsRepository88* 8
>888 9
(889 :
)88: ;
;88; <
services99 
.99 
	AddScoped99 
<99 
IAuthService99 %
,99% &
AuthService99' 2
>992 3
(993 4
)994 5
;995 6
services:: 
.:: 
	AddScoped:: 
<:: 
IReportsRepository:: +
,::+ ,
ReportsRepository::- >
>::> ?
(::? @
)::@ A
;::A B
services;; 
.;; 
AddTransient;; 
<;; 
IEmailSender;; (
,;;( )
EmailSender;;* 5
>;;5 6
(;;6 7
);;7 8
;;;8 9
var== 	
key==
 
=== 
Encoding== 
.== 
ASCII== 
.== 
GetBytes== '
(==' (
Configuration==( 5
[==5 6
$str==6 A
]==A B
)==B C
;==C D
services>> 
.>> 
AddAuthentication>>  
(>>  !
JwtBearerDefaults>>! 2
.>>2 3 
AuthenticationScheme>>3 G
)>>G H
.?? 	
AddJwtBearer??	 
(?? 
options?? 
=>??  
{@@ 	
optionsII
 
.II %
TokenValidationParametersII +
=II, -
newII. 1%
TokenValidationParametersII2 K
{JJ
 $
ValidateIssuerSigningKeyKK $
=KK% &
trueKK' +
,KK+ ,
IssuerSigningKeyLL 
=LL 
newLL " 
SymmetricSecurityKeyLL# 7
(LL7 8
keyLL8 ;
)LL; <
,LL< =
ValidateIssuerMM 
=MM 
falseMM "
,MM" #
ValidateAudienceNN 
=NN 
falseNN $
}OO
 
;OO 
}PP 	
)PP	 

;PP
 
servicesQQ 
.QQ 
AddSwaggerGenQQ 
(QQ 
)QQ 
;QQ 
}RR 
publicUU 

voidUU 
	ConfigureUU 
(UU 
IApplicationBuilderUU -
appUU. 1
,UU1 2
IWebHostEnvironmentUU3 F
envUUG J
)UUJ K
{VV 
ifWW 
(WW	 

envWW
 
.WW 
IsDevelopmentWW 
(WW 
)WW 
)WW 
{XX 
appYY 
.YY %
UseDeveloperExceptionPageYY %
(YY% &
)YY& '
;YY' (
}ZZ 
else[[ 

{\\ 
app]] 
.]] 
UseExceptionHandler]] 
(]]  
$str]]  (
)]]( )
;]]) *
app__ 
.__ 
UseHsts__ 
(__ 
)__ 
;__ 
}`` 
appbb 	
.bb	 

UseCorsbb
 
(bb 
$strbb &
)bb& '
;bb' (
appdd 	
.dd	 

UseHttpsRedirectiondd
 
(dd 
)dd 
;dd  
appee 	
.ee	 

UseStaticFilesee
 
(ee 
)ee 
;ee 
appgg 	
.gg	 


UseRoutinggg
 
(gg 
)gg 
;gg 
appii 	
.ii	 

UseAuthenticationii
 
(ii 
)ii 
;ii 
appjj 	
.jj	 

UseAuthorizationjj
 
(jj 
)jj 
;jj 
appll 	
.ll	 


UseSwaggerll
 
(ll 
)ll 
;ll 
appnn 	
.nn	 

UseSwaggerUInn
 
(nn 
cnn 
=>nn 
{oo 
cpp 	
.pp	 

SwaggerEndpointpp
 
(pp 
$strpp 4
,pp4 5
$strpp6 D
)ppD E
;ppE F
cqq 	
.qq	 

RoutePrefixqq
 
=qq 
stringqq 
.qq 
Emptyqq $
;qq$ %
}rr 
)rr 
;rr 	
apptt 	
.tt	 

UseEndpointstt
 
(tt 
	endpointstt  
=>tt! #
{uu 
	endpointsvv 
.vv 
MapControllersvv  
(vv  !
)vv! "
;vv" #
}ww 
)ww 
;ww 	
}xx 
}yy 
}zz 